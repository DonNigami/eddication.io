<!-- Test Page - Check Button Events -->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FlowAI Debug Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #007bff;
      border-radius: 4px;
    }
    .test-section h3 {
      margin-top: 0;
      color: #007bff;
    }
    .instruction {
      margin: 10px 0;
      padding: 10px;
      background: #e7f3ff;
      border-radius: 4px;
      color: #333;
    }
    code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
    .status {
      margin: 15px 0;
      padding: 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      padding: 8px 16px;
      margin: 5px 5px 5px 0;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #0056b3;
    }
    .log-area {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .log-entry {
      margin: 2px 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .log-entry.info { color: #4ec9b0; }
    .log-entry.warn { color: #ce9178; }
    .log-entry.error { color: #f48771; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Eddication Flow AI - Debug Test</h1>
    
    <div class="test-section">
      <h3>Extension Status</h3>
      <div id="extensionStatus" class="status info">
        checking...
      </div>
      <button onclick="checkExtensionStatus()">Check Status</button>
    </div>

    <div class="test-section">
      <h3>DOM Elements Check</h3>
      <p>Check if all required button elements exist:</p>
      <button onclick="checkDOMElements()">Check DOM Elements</button>
      <div id="domStatus"></div>
    </div>

    <div class="test-section">
      <h3>Console Simulation</h3>
      <p>Captured logs from background page:</p>
      <button onclick="fetchConsoleLogs()">Get Console Logs</button>
      <div class="log-area" id="logArea">
        No logs captured yet...
      </div>
    </div>

    <div class="test-section">
      <h3>Manual Button Tests</h3>
      <p>Click to test buttons in the extension:</p>
      <button onclick="sendMessageToExtension('test-refresh')">Test Refresh Button</button>
      <button onclick="sendMessageToExtension('test-settings')">Test Settings Button</button>
      <button onclick="sendMessageToExtension('test-warehouse')">Test Warehouse Button</button>
      <div id="testResult"></div>
    </div>

    <div class="test-section">
      <h3>Quick Help</h3>
      <ol>
        <li>Open <code>chrome://extensions/</code></li>
        <li>Find "Eddication Flow AI"</li>
        <li>Click "Service Worker" to open background page console</li>
        <li>Or right-click the extension icon and select "Inspect popup"</li>
        <li>Look for logs starting with <code>[FlowAI]</code></li>
      </ol>
    </div>
  </div>

  <script>
    function addLog(message, type = 'info') {
      const logArea = document.getElementById('logArea');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logArea.appendChild(entry);
      logArea.scrollTop = logArea.scrollHeight;
    }

    function checkExtensionStatus() {
      try {
        if (typeof chrome !== 'undefined' && chrome.extension) {
          const statusEl = document.getElementById('extensionStatus');
          statusEl.className = 'status success';
          statusEl.textContent = '‚úì Extension context detected';
          addLog('Extension context available', 'info');
        } else {
          const statusEl = document.getElementById('extensionStatus');
          statusEl.className = 'status error';
          statusEl.textContent = '‚úó No extension context - this is a web page test';
          addLog('Not in extension context', 'error');
        }
      } catch (error) {
        addLog('Error checking extension: ' + error.message, 'error');
      }
    }

    function checkDOMElements() {
      const elements = [
        'refreshDataBtn',
        'logoutBtn',
        'settingsBtn',
        'openWarehouseHeaderBtn',
        'openPromptWarehouseBtn',
        'openTestingPanelBtn',
        'appContainer',
        'licenseOverlay'
      ];

      let html = '<ul>';
      elements.forEach(id => {
        const exists = document.getElementById(id) !== null;
        const status = exists ? '‚úì' : '‚úó';
        const color = exists ? 'green' : 'red';
        html += `<li><span style="color: ${color};">${status}</span> #${id}</li>`;
        addLog(`Element #${id}: ${exists ? 'FOUND' : 'MISSING'}`, exists ? 'info' : 'error');
      });
      html += '</ul>';

      document.getElementById('domStatus').innerHTML = html;
    }

    function fetchConsoleLogs() {
      addLog('Note: This page cannot access extension console. Check:');
      addLog('1. chrome://extensions/ ‚Üí Service Worker', 'info');
      addLog('2. Right-click extension icon ‚Üí Inspect popup', 'info');
      addLog('3. Look for [FlowAI] prefix logs', 'warn');
    }

    function sendMessageToExtension(action) {
      try {
        if (chrome && chrome.runtime) {
          chrome.runtime.sendMessage({action}, response => {
            document.getElementById('testResult').innerHTML = 
              `<div class="status info">Message sent: ${action}</div>`;
            addLog(`Sent message: ${action}`, 'info');
          });
        } else {
          addLog('Extension runtime not available', 'error');
        }
      } catch (error) {
        addLog('Cannot communicate with extension: ' + error.message, 'error');
      }
    }

    // Auto-check on load
    window.addEventListener('load', () => {
      addLog('Test page loaded');
      checkExtensionStatus();
    });
  </script>
</body>
</html>
