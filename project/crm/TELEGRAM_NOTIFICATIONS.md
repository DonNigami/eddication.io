# Subscription Packages System - Telegram Notifications

## ЁЯФФ р╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Ьр╣Ир╕▓р╕Щ Telegram

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╣Ир╕Зр╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Др╕Ыр╕вр╕▒р╕З Telegram р╣Гр╕Щр╕Бр╕гр╕Ур╕╡р╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Й:

### 1. **р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И** ЁЯОЙ
р╣Ар╕бр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Бр╕ер╕░р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Фр╕кр╕ер╕┤р╕Ы р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ:
```
ЁЯОЙ р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И!

ЁЯСд р╕ер╕╣р╕Бр╕Др╣Йр╕▓: р╕Щр╕▓р╕вр╕кр╕бр╕Кр╕▓р╕в р╣Гр╕Ир╕Фр╕╡
ЁЯУ▒ р╣Ар╕Ър╕нр╕гр╣М: 0812345678
ЁЯТО р╣Бр╕Юр╕Др╣Ар╕Бр╕И: р╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Чр╕нр╕З
ЁЯТ░ р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░: р╕┐999
ЁЯУЕ р╕нр╕▓р╕вр╕╕: 30/12/2568 - 30/12/2569

тП│ р╕кр╕Цр╕▓р╕Щр╕░: р╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕ер╕┤р╕Ы
ЁЯФЧ Charge ID: chrg_test_xxx

р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
```

### 2. **р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ** тЬЕ
р╣Ар╕бр╕╖р╣Ир╕н Admin р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ:
```
тЬЕ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И!

ЁЯТО р╣Бр╕Юр╕Др╣Ар╕Бр╕И: р╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Чр╕нр╕З
ЁЯТ░ р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ: р╕┐999
тЬЕ р╕кр╕Цр╕▓р╕Щр╕░: р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з

р╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Йр╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╣Йр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з
```

## ЁЯУЛ Workflow

```
р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕бр╕▒р╕Др╕г тЖТ р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Фр╕кр╕ер╕┤р╕Ы тЖТ р╣Бр╕Ир╣Йр╕З Telegram
                    тЖУ
             Admin р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ
                    тЖУ
             р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ тЖТ р╣Бр╕Ир╣Йр╕З Telegram тЖТ Active р╕кр╕бр╕▓р╕Кр╕┤р╕Б
```

## ЁЯФз Configuration

Telegram credentials р╕Цр╕╣р╕Бр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Гр╕Щ Supabase Secrets:
- `TELEGRAM_BOT_TOKEN`: Bot token р╕Ир╕▓р╕Б @BotFather
- `TELEGRAM_CHAT_ID`: Chat ID р╕Чр╕╡р╣Ир╕Ир╕░р╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ

## ЁЯУЭ API Actions

### Create Customer Subscription
```typescript
{
  action: 'create-customer-subscription',
  package_id: 'uuid',
  customer_info: {
    name: 'р╕Кр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓',
    phone: '0812345678'
  },
  slip_url: 'https://...',
  charge_id: 'chrg_test_xxx',
  line_user_id: 'U1234567890'
}
```

### Verify Payment
```typescript
{
  action: 'verify-payment',
  payment_id: 'uuid',
  verified_by: 'admin_uuid'
}
```

## тЬи Features

- тЬЕ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И
- тЬЕ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
- тЬЕ р╕гр╕░р╕Ър╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ 100%
- тЬЕ р╕гр╕нр╕Зр╕гр╕▒р╕Ъ HTML formatting р╣Гр╕Щ Telegram
- тЬЕ р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
- тЬЕ Error handling

## ЁЯЪА р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

1. р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕лр╕Щр╣Йр╕▓ `subscribe.html`
2. р╣Ар╕ер╕╖р╕нр╕Бр╣Бр╕Юр╕Др╣Ар╕Бр╕И
3. р╕кр╣Бр╕Бр╕Щ QR PromptPay
4. р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Фр╕кр╕ер╕┤р╕Ы
5. **тЖТ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ Telegram р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤**
6. Admin р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щ `packages-admin.html`
7. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤"
8. **тЖТ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ Telegram р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤**
9. р╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡

## ЁЯУ▒ р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ

```bash
# Test via curl
curl -X POST https://[project-ref].supabase.co/functions/v1/subscription-manager \
  -H "Authorization: Bearer [anon-key]" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "create-customer-subscription",
    "package_id": "test-package-id",
    "customer_info": {
      "name": "Test User",
      "phone": "0812345678"
    },
    "slip_url": "https://example.com/slip.jpg",
    "line_user_id": "test-user-id"
  }'
```
