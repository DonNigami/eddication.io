<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å - {{ shopName }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.omise.co/omise.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">

    <div id="app" class="container mx-auto px-4 py-8 max-w-6xl">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üéâ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
            <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢!</p>
        </div>

        <!-- Packages Selection -->
        <div v-if="!selectedPackage" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div v-for="pkg in packages" :key="pkg.id"
                class="bg-white rounded-lg shadow-xl overflow-hidden transform transition-all hover:scale-105 cursor-pointer border-4"
                :class="[pkg.is_recommended ? 'border-yellow-400' : 'border-transparent', pkg.is_custom ? 'border-purple-400 border-dashed' : '']"
                :style="`border-top: 6px solid ${pkg.color_theme}`"
                @click="pkg.is_custom ? contactAdmin(pkg.contact_line) : selectPackage(pkg)">

                <div v-if="pkg.is_recommended" class="bg-yellow-400 text-yellow-900 text-center py-2 text-sm font-bold">
                    ‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                </div>

                <div v-if="pkg.is_custom" class="bg-purple-600 text-white text-center py-2 text-sm font-bold">
                    üíº Enterprise
                </div>

                <div class="p-6">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold mb-1" :style="`color: ${pkg.color_theme}`">
                            {{ pkg.name }}
                        </h3>
                        <p class="text-gray-500 text-sm">{{ pkg.name_en }}</p>
                    </div>

                    <div class="text-center mb-6">
                        <!-- Custom Package Price Display -->
                        <div v-if="pkg.is_custom">
                            <div class="text-2xl font-bold text-purple-600 mb-2">
                                ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                            </div>
                            <div class="text-sm text-gray-600">
                                ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                            </div>
                        </div>

                        <!-- Standard Package Price Display -->
                        <div v-else>
                            <div class="text-3xl font-bold text-gray-800 mb-2">
                                ‡∏ø{{ pkg.price_monthly.toLocaleString() }}
                            </div>
                            <div class="text-sm text-gray-600 mb-3">
                                /‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            </div>
                            <div class="flex gap-2 justify-center flex-wrap">
                                <div class="bg-gray-100 px-3 py-1.5 rounded text-xs border border-gray-300">
                                    <div class="text-gray-500 text-[10px]">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏•‡∏î 5%)</div>
                                    <div class="line-through text-gray-400 text-[10px]">‡∏ø{{ (pkg.price_monthly *
                                        6).toLocaleString() }}</div>
                                    <span class="font-bold text-green-600">‡∏ø{{ Math.round(pkg.price_monthly * 6 *
                                        0.95).toLocaleString() }}</span>
                                </div>
                                <div class="bg-blue-100 px-3 py-1.5 rounded text-xs border border-blue-300">
                                    <div class="text-blue-600 text-[10px]">12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏•‡∏î 10%)</div>
                                    <div class="line-through text-gray-400 text-[10px]">‡∏ø{{ (pkg.price_monthly *
                                        12).toLocaleString() }}</div>
                                    <span class="font-bold text-blue-700">‡∏ø{{ Math.round(pkg.price_monthly * 12 *
                                        0.90).toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Highlights -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                            <span class="text-xl font-bold text-green-600">{{ pkg.discount_percent }}%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</span>
                            <span class="text-xl font-bold text-blue-600">{{ pkg.points_multiplier }}x</span>
                        </div>
                    </div>

                    <!-- Benefits -->
                    <div class="space-y-3 mb-6">
                        <div v-for="(benefit, idx) in pkg.benefits" :key="idx" class="flex items-start">
                            <span class="text-green-500 mr-2 mt-0.5">‚úì</span>
                            <span class="text-gray-700 text-sm">{{ benefit }}</span>
                        </div>
                    </div>

                    <button class="w-full py-3 rounded-lg font-semibold transition-colors"
                        :style="`background-color: ${pkg.color_theme}; color: white`">
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>
        </div>

        <!-- Payment Step -->
        <div v-if="selectedPackage && !paymentCompleted" class="max-w-2xl mx-auto">
            <div class="bg-white rounded-lg shadow-xl p-8">

                <!-- Back Button -->
                <button @click="selectedPackage = null"
                    class="mb-6 text-blue-600 hover:text-blue-800 flex items-center">
                    ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à
                </button>

                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    <p class="text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                </div>

                <!-- Duration Selection -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-gray-700 mb-3">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                    <div class="grid grid-cols-2 gap-4">
                        <button @click="selectDuration(6)"
                            :class="selectedDuration === 6 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300'"
                            class="border-2 rounded-lg p-4 font-bold transition-all hover:border-blue-500">
                            <div class="text-2xl">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="text-sm mt-1">‡∏ø{{ (selectedPackage.price_monthly * 6).toLocaleString() }}</div>
                            <div class="text-xs mt-1 opacity-75">‡∏ø{{ selectedPackage.price_monthly.toLocaleString()
                                }}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                        </button>
                        <button @click="selectDuration(12)"
                            :class="selectedDuration === 12 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300'"
                            class="border-2 rounded-lg p-4 font-bold transition-all hover:border-blue-500 relative">
                            <div
                                class="absolute -top-2 -right-2 bg-yellow-400 text-yellow-900 text-xs px-2 py-1 rounded-full">
                                ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î!
                            </div>
                            <div class="text-2xl">12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            <div class="text-sm mt-1">‡∏ø{{ (selectedPackage.price_monthly * 12).toLocaleString() }}</div>
                            <div class="text-xs mt-1 opacity-75">‡∏ø{{ selectedPackage.price_monthly.toLocaleString()
                                }}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                        </button>
                    </div>
                </div>

                <!-- Selected Package Summary -->
                <div class="bg-gray-50 rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <div class="font-bold text-xl" :style="`color: ${selectedPackage.color_theme}`">
                                {{ selectedPackage.name }}
                            </div>
                            <div class="text-sm text-gray-600">{{ selectedPackage.name_en }}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold text-gray-800">
                                ‡∏ø{{ calculatePrice().toLocaleString() }}
                            </div>
                            <div class="text-sm text-gray-600">{{ selectedDuration }} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <div class="text-sm text-gray-600 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="flex items-center text-sm">
                                <span class="text-green-500 mr-1">‚úì</span>
                                <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î {{ selectedPackage.discount_percent }}%</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <span class="text-green-500 mr-1">‚úì</span>
                                <span>‡πÅ‡∏ï‡πâ‡∏° {{ selectedPackage.points_multiplier }}x</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QR Code Display -->
                <div v-if="qrCodeUrl" class="text-center mb-6">
                    <div class="bg-white p-6 rounded-lg border-4 border-blue-500 inline-block mb-4">
                        <img :src="qrCodeUrl" alt="PromptPay QR Code" class="w-64 h-64">
                    </div>

                    <div class="text-sm text-gray-600 mb-2">
                        ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô PromptPay
                    </div>
                    <div class="font-mono font-bold text-xl text-gray-800 mb-4">
                        {{ selectedPackage.promptpay_phone || '065-698-7889' }}
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                        <p class="text-sm text-yellow-800">
                            ‚ö†Ô∏è ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </p>
                    </div>
                </div>

                <!-- Upload Slip -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô *
                    </label>
                    <input type="file" @change="handleSlipUpload" accept="image/*"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg">

                    <div v-if="slipPreview" class="mt-4">
                        <img :src="slipPreview" alt="Slip Preview" class="max-w-xs mx-auto rounded-lg shadow">
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input v-model="contactInfo.name" type="text"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                        <input v-model="contactInfo.phone" type="tel"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0812345678">
                    </div>
                </div>

                <!-- Submit Button -->
                <button @click="submitSubscription" :disabled="!canSubmit || isSubmitting"
                    class="w-full py-4 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                    {{ isSubmitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' }}
                </button>

                <p class="text-xs text-center text-gray-500 mt-4">
                    * ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô 1-2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏´‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                </p>
            </div>
        </div>

        <!-- Success Step -->
        <div v-if="paymentCompleted" class="max-w-2xl mx-auto">
            <div class="bg-white rounded-lg shadow-xl p-8 text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-4xl">‚úÖ</span>
                </div>

                <h2 class="text-3xl font-bold text-gray-800 mb-4">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                <p class="text-gray-600 mb-8">
                    ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß<br>
                    ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                </p>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                    <div class="text-sm text-gray-600 mb-2">‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                    <div class="text-xl font-bold" :style="`color: ${selectedPackage.color_theme}`">
                        {{ selectedPackage.name }}
                    </div>
                    <div class="text-sm text-gray-600 mt-2">
                        ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: {{ selectedDuration }} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </div>
                    <div class="text-2xl font-bold text-gray-800 mt-2">
                        ‡∏ø{{ calculatePrice().toLocaleString() }}
                    </div>
                </div>

                <div class="space-y-3 text-sm text-gray-600 mb-8">
                    <p>‚úì ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                    <p>‚úì ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ {{ selectedDuration }} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                    <p>‚úì ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                </div>

                <button @click="goToHome"
                    class="px-8 py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition-colors">
                    ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue

        // Initialize Omise
        Omise.setPublicKey('pkey_test_5wox4qrw56h1jiwb0gl')

        createApp({
            data() {
                return {
                    packages: [],
                    selectedPackage: null,
                    selectedDuration: 12, // Default 12 months
                    qrCodeUrl: null,
                    chargeId: null,
                    slipFile: null,
                    slipPreview: null,
                    contactInfo: {
                        name: '',
                        phone: ''
                    },
                    paymentCompleted: false,
                    isSubmitting: false,
                    supabase: null,
                    lineUserId: null,
                    tenantId: null
                }
            },
            computed: {
                canSubmit() {
                    return this.slipFile &&
                        this.contactInfo.name &&
                        this.contactInfo.phone
                }
            },
            async mounted() {
                // Initialize Supabase
                this.supabase = window.supabase.createClient(
                    'https://ckhwouxtrvuthefkxnxb.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNraHdvdXh0cnZ1dGhlZmt4bnhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMTcxMjcsImV4cCI6MjA4MjU5MzEyN30.nrJ7es0Zo5Tp77v4Vt8nndgPpOULKf6hc9Nf3L-zxF4'
                )

                // Initialize LIFF (optional - app works without it)
                try {
                    // LINE LIFF ID for integration
                    const liffId = '2006397073-3wO44G35';
                    if (liffId && typeof liff !== 'undefined') {
                        await liff.init({ liffId })
                        if (liff.isLoggedIn()) {
                            const profile = await liff.getProfile()
                            this.lineUserId = profile.userId
                            this.contactInfo.name = profile.displayName
                            console.log('‚úÖ LIFF initialized successfully')
                        }
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è LIFF init failed (will continue without LINE integration):', err.message)
                    // Continue without LIFF - user can still submit manually
                }

                // TODO: Get tenantId from URL or context
                this.tenantId = 'demo-tenant-id'

                await this.loadPackages()
            },
            methods: {
                async loadPackages() {
                    // TODO: Load from Supabase
                    // const { data } = await this.supabase
                    //     .from('subscription_packages')
                    //     .select('*')
                    //     .eq('tenant_id', this.tenantId)
                    //     .eq('is_active', true)
                    //     .order('sort_order')

                    this.packages = [
                        {
                            id: '1',
                            name: 'Silver',
                            name_en: 'Silver Member',
                            description: '‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SME ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å',
                            price_monthly: 449,
                            discount_percent: 3,
                            points_multiplier: 1.2,
                            color_theme: '#94A3B8',
                            benefits: [
                                '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 3% ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠',
                                '‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏° 1.2 ‡πÄ‡∏ó‡πà‡∏≤',
                                '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 500 ‡∏Ñ‡∏ô',
                                '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                                '‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£'
                            ],
                            promptpay_phone: '0656987889',
                            is_active: true
                        },
                        {
                            id: '2',
                            name: 'Gold',
                            name_en: 'Gold Member',
                            description: '‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SME ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á',
                            price_monthly: 899,
                            discount_percent: 5,
                            points_multiplier: 1.5,
                            color_theme: '#FCD34D',
                            benefits: [
                                '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 5% ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠',
                                '‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏° 1.5 ‡πÄ‡∏ó‡πà‡∏≤',
                                '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                                '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á',
                                '‡∏™‡πà‡∏á SMS/LINE ‡∏ñ‡∏∂‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                                '‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                                '‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                                '‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°'
                            ],
                            promptpay_phone: '0656987889',
                            is_active: true,
                            is_recommended: true
                        },
                        {
                            id: '3',
                            name: 'Diamond',
                            name_en: 'Diamond Member',
                            description: '‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',
                            price_monthly: 1949,
                            discount_percent: 10,
                            points_multiplier: 2.0,
                            color_theme: '#60A5FA',
                            benefits: [
                                '‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠',
                                '‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏° 2 ‡πÄ‡∏ó‡πà‡∏≤',
                                '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                                'AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                                '‡∏™‡πà‡∏á Broadcast ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                                'API Integration',
                                'Multi-branch support',
                                '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß 1:1',
                                '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô 24/7',
                                '‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô 100% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô'
                            ],
                            promptpay_phone: '0656987889',
                            is_active: true
                        },
                        {
                            id: '4',
                            name: 'Enterprise',
                            name_en: 'Enterprise Solution',
                            description: '‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞',
                            price_monthly: null,
                            is_custom: true,
                            color_theme: '#8B5CF6',
                            benefits: [
                                '‡∏£‡∏∞‡∏ö‡∏ö CRM ‡πÅ‡∏ö‡∏ö Custom ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                                'API & Integration ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î',
                                'Multi-tenant & White Label',
                                '‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ (Dedicated Server)',
                                '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Technical Support 24/7',
                                '‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á (Dedicated Consultant)',
                                'Training & Workshop ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°',
                                'SLA Guarantee 99.9%',
                                'Custom Report & Dashboard',
                                'Advanced Security & Compliance'
                            ],
                            contact_line: '@eddication',
                            is_active: true
                        }
                    ]
                },
                async selectPackage(pkg) {
                    this.selectedPackage = pkg
                    this.selectedDuration = 12 // Default to 12 months
                    await this.generateQRCode()
                },
                contactAdmin(lineId) {
                    const message = encodeURIComponent('‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à Enterprise ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£')
                    const lineUrl = `https://line.me/R/ti/p/${lineId}?text=${message}`

                    if (typeof liff !== 'undefined' && liff.isInClient()) {
                        liff.openWindow({
                            url: lineUrl,
                            external: true
                        })
                    } else {
                        window.open(lineUrl, '_blank')
                    }
                },
                selectDuration(months) {
                    this.selectedDuration = months
                    this.generateQRCode()
                },
                calculatePrice() {
                    const basePrice = this.selectedPackage.price_monthly * this.selectedDuration
                    let discount = 0

                    // Apply duration discount
                    if (this.selectedDuration === 6) {
                        discount = 0.05 // 5% discount for 6 months
                    } else if (this.selectedDuration === 12) {
                        discount = 0.10 // 10% discount for 12 months
                    }

                    return Math.round(basePrice * (1 - discount))
                },
                getOriginalPrice() {
                    return this.selectedPackage.price_monthly * this.selectedDuration
                },
                getDiscountPercent() {
                    if (this.selectedDuration === 6) return 5
                    if (this.selectedDuration === 12) return 10
                    return 0
                },
                async generateQRCode() {
                    try {
                        const amount = this.calculatePrice()
                        const phoneNumber = '0656987889'

                        // Generate PromptPay QR Code using promptpay.io
                        this.qrCodeUrl = `https://promptpay.io/${phoneNumber}/${amount}.png`

                        console.log('QR Code generated:', this.qrCodeUrl)
                    } catch (error) {
                        console.error('QR generation failed:', error)
                        Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÑ‡∏î‡πâ', 'error')
                    }
                },
                handleSlipUpload(event) {
                    const file = event.target.files[0]
                    if (file) {
                        this.slipFile = file
                        const reader = new FileReader()
                        reader.onload = (e) => {
                            this.slipPreview = e.target.result
                        }
                        reader.readAsDataURL(file)
                    }
                },
                async submitSubscription() {
                    this.isSubmitting = true

                    try {
                        // Upload slip to Supabase Storage
                        const fileName = `slips/${Date.now()}_${this.slipFile.name}`

                        const { data: uploadData, error: uploadError } = await this.supabase.storage
                            .from('payment-slips')
                            .upload(fileName, this.slipFile, {
                                cacheControl: '3600',
                                upsert: false
                            })

                        if (uploadError) {
                            console.error('Upload error:', uploadError)
                            throw new Error(`Storage error: ${uploadError.message}`)
                        }

                        const { data: { publicUrl } } = this.supabase.storage
                            .from('payment-slips')
                            .getPublicUrl(fileName)

                        // Save to database
                        const { data: savedSubmission, error: dbError } = await this.supabase
                            .from('subscription_requests')
                            .insert([{
                                package_id: this.selectedPackage.id,
                                package_name: this.selectedPackage.name,
                                customer_name: this.contactInfo.name,
                                customer_phone: this.contactInfo.phone,
                                slip_url: publicUrl,
                                line_user_id: this.lineUserId,
                                duration_months: this.selectedDuration,
                                total_price: this.calculatePrice(),
                                original_price: this.getOriginalPrice(),
                                discount_percent: this.getDiscountPercent(),
                                status: 'pending',
                                created_at: new Date().toISOString()
                            }])
                            .select()
                            .single()

                        if (dbError) {
                            console.warn('‚ö†Ô∏è Could not save to database:', dbError.message)
                        } else {
                            console.log('‚úÖ Saved to database:', savedSubmission)
                        }

                        // Send Telegram notification directly
                        try {
                            const { data: telegramConfig } = await this.supabase.rpc('get_telegram_config')

                            if (telegramConfig && telegramConfig.telegram_bot_token && telegramConfig.telegram_chat_id) {
                                const message = `
üéâ *‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà*

üë§ *‡∏ä‡∏∑‡πà‡∏≠:* ${this.contactInfo.name}
üì± *‡πÄ‡∏ö‡∏≠‡∏£‡πå:* ${this.contactInfo.phone}

üíé *‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à:* ${this.selectedPackage.name}
‚è± *‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:* ${this.selectedDuration} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
üí∞ *‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:* ‡∏ø${this.calculatePrice().toLocaleString()}

üìé [‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô](${publicUrl})

üïê ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}
`.trim()

                                await fetch(`https://api.telegram.org/bot${telegramConfig.telegram_bot_token}/sendMessage`, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        chat_id: telegramConfig.telegram_chat_id,
                                        text: message,
                                        parse_mode: 'Markdown'
                                    })
                                })
                                console.log('‚úÖ Telegram notification sent')
                            }
                        } catch (err) {
                            console.warn('‚ö†Ô∏è Telegram notification failed:', err.message)
                        }

                        // Show success notification
                        await Swal.fire({
                            icon: 'success',
                            title: '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                            text: '‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                        })

                        this.paymentCompleted = true

                    } catch (error) {
                        console.error('Submission failed:', error)
                        Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ: ' + error.message, 'error')
                    } finally {
                        this.isSubmitting = false
                    }
                },
                goToHome() {
                    if (liff.isInClient()) {
                        liff.closeWindow()
                    } else {
                        window.location.href = '/'
                    }
                }
            }
        }).mount('#app')
    </script>
</body>

</html>