<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô CRM Pro - Multi-tenant SaaS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.omise.co/omise.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Onboarding Wizard -->
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl">

        <!-- Progress Steps -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div v-for="(step, idx) in steps" :key="idx" class="flex-1 flex items-center"
                    :class="idx < steps.length - 1 ? 'mr-4' : ''">
                    <div class="flex items-center flex-1">
                        <div class="flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all"
                            :class="currentStep > idx ? 'bg-green-500 border-green-500 text-white' : 
                                     currentStep === idx ? 'bg-blue-500 border-blue-500 text-white' : 
                                     'bg-white border-gray-300 text-gray-500'">
                            <span v-if="currentStep > idx">‚úì</span>
                            <span v-else>{{ idx + 1 }}</span>
                        </div>
                        <div v-if="idx < steps.length - 1" class="flex-1 h-1 mx-2 rounded"
                            :class="currentStep > idx ? 'bg-green-500' : 'bg-gray-300'">
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-2">
                <div v-for="(step, idx) in steps" :key="idx" class="text-xs font-medium"
                    :class="currentStep >= idx ? 'text-blue-600' : 'text-gray-500'">
                    {{ step }}
                </div>
            </div>
        </div>

        <!-- Step 1: Organization Info -->
        <div v-if="currentStep === 0" class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h2>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ *</label>
                    <input v-model="formData.organizationName" type="text"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Subdomain *</label>
                    <div class="flex items-center">
                        <input v-model="formData.subdomain" type="text"
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="your-company" @input="checkSubdomainAvailability">
                        <span
                            class="px-4 py-2 bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg text-gray-600">
                            .crmpro.app
                        </span>
                    </div>
                    <p v-if="subdomainStatus === 'available'" class="text-xs text-green-600 mt-1">
                        ‚úì Subdomain ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    </p>
                    <p v-if="subdomainStatus === 'taken'" class="text-xs text-red-600 mt-1">
                        ‚úó Subdomain ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß
                    </p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                    <input v-model="formData.email" type="email"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="admin@company.com">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                    <select v-model="formData.companySize"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="1-10">1-10 ‡∏Ñ‡∏ô</option>
                        <option value="11-50">11-50 ‡∏Ñ‡∏ô</option>
                        <option value="51-200">51-200 ‡∏Ñ‡∏ô</option>
                        <option value="200+">‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 200 ‡∏Ñ‡∏ô</option>
                    </select>
                </div>
            </div>

            <div class="flex justify-end mt-8">
                <button @click="nextStep" :disabled="!canProceedStep1"
                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                </button>
            </div>
        </div>

        <!-- Step 2: Choose Plan -->
        <div v-if="currentStep === 1" class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h2>
            <p class="text-gray-600 mb-6">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ 14 ‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</p>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Free Plan -->
                <div class="border-2 rounded-lg p-6 cursor-pointer transition-all"
                    :class="formData.selectedPlan === 'free' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                    @click="formData.selectedPlan = 'free'">
                    <div class="text-center">
                        <h3 class="text-xl font-bold text-gray-800">Free</h3>
                        <div class="my-4">
                            <span class="text-4xl font-bold">‡∏ø0</span>
                            <span class="text-gray-600">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                        </div>
                        <ul class="text-left space-y-2 text-sm">
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 500 ‡∏£‡∏≤‡∏¢</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 2 ‡∏Ñ‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° 1,000/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>CRM ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Starter Plan -->
                <div class="border-2 rounded-lg p-6 cursor-pointer transition-all relative"
                    :class="formData.selectedPlan === 'starter' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                    @click="formData.selectedPlan = 'starter'">
                    <div
                        class="absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 text-xs rounded-bl-lg rounded-tr-lg">
                        ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                    </div>
                    <div class="text-center">
                        <h3 class="text-xl font-bold text-gray-800">Starter</h3>
                        <div class="my-4">
                            <span class="text-4xl font-bold">‡∏ø990</span>
                            <span class="text-gray-600">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                        </div>
                        <ul class="text-left space-y-2 text-sm">
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 5,000 ‡∏£‡∏≤‡∏¢</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 5 ‡∏Ñ‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° 10,000/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>API Access</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Pro Plan -->
                <div class="border-2 rounded-lg p-6 cursor-pointer transition-all"
                    :class="formData.selectedPlan === 'pro' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'"
                    @click="formData.selectedPlan = 'pro'">
                    <div class="text-center">
                        <h3 class="text-xl font-bold text-gray-800">Pro</h3>
                        <div class="my-4">
                            <span class="text-4xl font-bold">‡∏ø2,990</span>
                            <span class="text-gray-600">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                        </div>
                        <ul class="text-left space-y-2 text-sm">
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 50,000 ‡∏£‡∏≤‡∏¢</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 20 ‡∏Ñ‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° 100,000/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>Automation</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-green-500 mr-2">‚úì</span>
                                <span>Priority Support</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button @click="prevStep"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button @click="nextStep"
                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                </button>
            </div>
        </div>

        <!-- Step 3: Payment (if not free) -->
        <div v-if="currentStep === 2 && formData.selectedPlan !== 'free'" class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <p class="text-blue-800 text-sm">
                    üéâ ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ 14 ‡∏ß‡∏±‡∏ô - ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
                </p>
            </div>

            <div id="omise-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£</label>
                    <input v-model="paymentData.cardNumber" type="text" maxlength="19"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1234 5678 9012 3456">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</label>
                        <input v-model="paymentData.expiry" type="text" maxlength="5"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="MM/YY">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                        <input v-model="paymentData.cvv" type="text" maxlength="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="123">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ô‡∏ö‡∏±‡∏ï‡∏£</label>
                    <input v-model="paymentData.cardName" type="text"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="JOHN DOE">
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button @click="prevStep"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button @click="nextStep" :disabled="!canProceedPayment"
                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                </button>
            </div>
        </div>

        <!-- Step 4: Review & Confirm -->
        <div v-if="currentStep === (formData.selectedPlan === 'free' ? 2 : 3)"
            class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>

            <div class="space-y-6">
                <div class="border-b pb-4">
                    <h3 class="font-semibold text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h3>
                    <p class="text-gray-600">{{ formData.organizationName }}</p>
                    <p class="text-gray-600 text-sm">{{ formData.subdomain }}.crmpro.app</p>
                    <p class="text-gray-600 text-sm">{{ formData.email }}</p>
                </div>

                <div class="border-b pb-4">
                    <h3 class="font-semibold text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
                    <p class="text-gray-600 text-lg font-bold">
                        {{ formData.selectedPlan === 'free' ? 'Free' : formData.selectedPlan === 'starter' ? 'Starter' :
                        'Pro' }}
                        {{ formData.selectedPlan !== 'free' ? `- ‡∏ø${formData.selectedPlan === 'starter' ? '990' :
                        '2,990'}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô` : '' }}
                    </p>
                    <p v-if="formData.selectedPlan !== 'free'" class="text-sm text-green-600 mt-1">
                        ‚úì ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ 14 ‡∏ß‡∏±‡∏ô
                    </p>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <label class="flex items-center">
                        <input v-model="acceptTerms" type="checkbox" class="mr-2">
                        <span class="text-sm text-gray-700">
                            ‡∏â‡∏±‡∏ô‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö <a href="#" class="text-blue-500 hover:underline">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
                            ‡πÅ‡∏•‡∏∞ <a href="#" class="text-blue-500 hover:underline">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                        </span>
                    </label>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button @click="prevStep"
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button @click="createTenant" :disabled="!acceptTerms || isCreating"
                    class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                    {{ isCreating ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...' : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' }}
                </button>
            </div>
        </div>

        <!-- Step 5: Success -->
        <div v-if="currentStep === (formData.selectedPlan === 'free' ? 3 : 4)"
            class="bg-white rounded-lg shadow-lg p-8 text-center">
            <div class="mb-6">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto">
                    <span class="text-4xl">üéâ</span>
                </div>
            </div>

            <h2 class="text-3xl font-bold text-gray-800 mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà CRM Pro!</h2>
            <p class="text-gray-600 mb-8">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>

            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                <p class="text-sm text-gray-600 mb-2">URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                <p class="text-xl font-mono text-blue-600">{{ formData.subdomain }}.crmpro.app</p>
                <button @click="copyUrl" class="mt-2 text-sm text-blue-500 hover:underline">
                    ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                </button>
            </div>

            <button @click="goToDashboard"
                class="px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô CRM
            </button>
        </div>

    </div>

    <script>
        const { createApp } = Vue

        // Initialize Omise
        Omise.setPublicKey('pkey_test_your_key_here') // TODO: Replace with real key

        createApp({
            data() {
                return {
                    steps: ['‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô', '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö', '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'],
                    currentStep: 0,
                    formData: {
                        organizationName: '',
                        subdomain: '',
                        email: '',
                        companySize: '1-10',
                        selectedPlan: 'starter'
                    },
                    paymentData: {
                        cardNumber: '',
                        expiry: '',
                        cvv: '',
                        cardName: ''
                    },
                    subdomainStatus: null,
                    acceptTerms: false,
                    isCreating: false,
                    lineUserId: null,
                    supabase: null
                }
            },
            computed: {
                canProceedStep1() {
                    return this.formData.organizationName &&
                        this.formData.subdomain &&
                        this.formData.email &&
                        this.subdomainStatus === 'available'
                },
                canProceedPayment() {
                    return this.paymentData.cardNumber.length >= 15 &&
                        this.paymentData.expiry.length === 5 &&
                        this.paymentData.cvv.length === 3 &&
                        this.paymentData.cardName
                }
            },
            async mounted() {
                // Initialize Supabase
                this.supabase = window.supabase.createClient(
                    'https://ckhwouxtrvuthefkxnxb.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNraHdvdXh0cnZ1dGhlZmt4bnhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ1MzU4NDAsImV4cCI6MjA1MDExMTg0MH0.Vn-V7nDXON7vRCEp2KzPQwvTv2X_nFZxlq6nZBK8jpw'
                )

                // Initialize LIFF
                try {
                    await liff.init({ liffId: '2006652117-vZO91aAk' })
                    if (liff.isLoggedIn()) {
                        const profile = await liff.getProfile()
                        this.lineUserId = profile.userId
                    }
                } catch (err) {
                    console.error('LIFF init failed:', err)
                }
            },
            methods: {
                nextStep() {
                    if (this.formData.selectedPlan === 'free' && this.currentStep === 1) {
                        this.currentStep = 2 // Skip payment step
                    } else {
                        this.currentStep++
                    }
                },
                prevStep() {
                    if (this.formData.selectedPlan === 'free' && this.currentStep === 2) {
                        this.currentStep = 1 // Skip payment step
                    } else {
                        this.currentStep--
                    }
                },
                async checkSubdomainAvailability() {
                    if (!this.formData.subdomain) {
                        this.subdomainStatus = null
                        return
                    }

                    const { data } = await this.supabase
                        .from('tenants')
                        .select('id')
                        .eq('subdomain', this.formData.subdomain)
                        .maybeSingle()

                    this.subdomainStatus = data ? 'taken' : 'available'
                },
                async createTenant() {
                    this.isCreating = true

                    try {
                        let tokenId = null

                        // Create Omise token if not free plan
                        if (this.formData.selectedPlan !== 'free') {
                            const [month, year] = this.paymentData.expiry.split('/')

                            tokenId = await new Promise((resolve, reject) => {
                                Omise.createToken('card', {
                                    name: this.paymentData.cardName,
                                    number: this.paymentData.cardNumber.replace(/\s/g, ''),
                                    expiration_month: month,
                                    expiration_year: `20${year}`,
                                    security_code: this.paymentData.cvv
                                }, (statusCode, response) => {
                                    if (response.object === 'token') {
                                        resolve(response.id)
                                    } else {
                                        reject(new Error(response.message))
                                    }
                                })
                            })
                        }

                        // Call tenant-manager function
                        const { data: tenantData } = await this.supabase.functions.invoke('tenant-manager', {
                            body: {
                                action: 'create-tenant',
                                name: this.formData.organizationName,
                                subdomain: this.formData.subdomain,
                                admin_email: this.formData.email,
                                admin_line_id: this.lineUserId,
                                plan: this.formData.selectedPlan
                            }
                        })

                        if (!tenantData.success) {
                            throw new Error('Failed to create tenant')
                        }

                        // Create subscription if not free
                        if (this.formData.selectedPlan !== 'free') {
                            await this.supabase.functions.invoke('subscription-manager', {
                                body: {
                                    action: 'create-subscription',
                                    tenant_id: tenantData.tenant.id,
                                    plan: this.formData.selectedPlan,
                                    token_id: tokenId
                                }
                            })
                        }

                        this.nextStep()
                    } catch (error) {
                        Swal.fire('Error', error.message, 'error')
                    } finally {
                        this.isCreating = false
                    }
                },
                copyUrl() {
                    navigator.clipboard.writeText(`https://${this.formData.subdomain}.crmpro.app`)
                    Swal.fire('Success', '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß', 'success')
                },
                goToDashboard() {
                    window.location.href = `https://${this.formData.subdomain}.crmpro.app`
                }
            }
        }).mount('#app')
    </script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</body>

</html>