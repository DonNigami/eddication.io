{"version":3,"file":"index-BhjD8Slb.js","sources":["../../src/main.ts"],"sourcesContent":["/**\n * ClinicConnect - LIFF Patient App Main Entry Point\n */\n\nimport { liff } from '@line/liff';\nimport { createClient } from '@supabase/supabase-js';\nimport { AppointmentStatus } from '@clinic/config';\n\n// =====================================================\n// ENVIRONMENT VARIABLES\n// =====================================================\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || '';\nconst SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || '';\nconst LINE_LIFF_ID = import.meta.env.VITE_LINE_LIFF_ID || '';\n\n// =====================================================\n// TYPES\n// =====================================================\n\ninterface User {\n  userId: string;\n  displayName: string;\n  pictureUrl?: string;\n  email?: string;\n}\n\ninterface Appointment {\n  appointment_id: string;\n  appointment_date: string;\n  appointment_time: string;\n  queue_number: number;\n  status: AppointmentStatus;\n  doctor: {\n    name: string;\n    specialty: string;\n  };\n}\n\ninterface NewsArticle {\n  article_id: string;\n  title: string;\n  excerpt: string;\n  cover_image: string;\n  created_at: string;\n}\n\n// =====================================================\n// STATE\n// =====================================================\n\nlet currentUser: User | null = null;\nlet currentPage: string = 'home';\nlet pageHistory: string[] = [];\n\n// Supabase client\nconst supabase = createClient(\n  SUPABASE_URL,\n  SUPABASE_ANON_KEY\n);\n\n// =====================================================\n// LIFF INITIALIZATION\n// =====================================================\n\nasync function initializeLiff(): Promise<void> {\n  try {\n    await liff.init({ liffId: LINE_LIFF_ID });\n\n    if (!liff.isLoggedIn()) {\n      liff.login();\n      return;\n    }\n\n    // Get user profile\n    const profile = liff.getDecodedIDToken();\n    currentUser = {\n      userId: profile.sub,\n      displayName: profile.name || 'ผู้ใช้',\n      pictureUrl: profile.picture,\n    };\n\n    // Hide loading, show app\n    document.getElementById('loading-screen')?.classList.add('hidden');\n    document.getElementById('main-app')?.classList.remove('hidden');\n\n    // Update UI with user info\n    updateGreeting();\n\n    // Check if user is registered\n    const patient = await checkUserRegistration(currentUser.userId);\n\n    if (!patient) {\n      // User not registered, show registration page\n      navigateTo('register');\n      return;\n    }\n\n    // Load initial data\n    await loadHomePage();\n\n  } catch (error) {\n    console.error('LIFF initialization failed:', error);\n\n    // Hide loading screen even on error - prevent stuck screen\n    document.getElementById('loading-screen')?.classList.add('hidden');\n    document.getElementById('main-app')?.classList.remove('hidden');\n\n    // Show error message to user\n    showToast('ไม่สามารถเชื่อมต่อ LINE ได้ กรุณาลองใหม่', 'error');\n\n    // Set demo user for development/testing\n    currentUser = {\n      userId: 'demo-user',\n      displayName: 'ผู้ใช้ทดสอบ',\n      pictureUrl: '',\n    };\n    updateGreeting();\n  }\n}\n\n// =====================================================\n// NAVIGATION\n// =====================================================\n\nfunction navigateTo(pageId: string): void {\n  // Hide current page\n  document.querySelectorAll('.page').forEach(page => {\n    page.classList.remove('active');\n  });\n\n  // Show target page\n  const targetPage = document.getElementById(`page-${pageId}`);\n  if (targetPage) {\n    targetPage.classList.add('active');\n  }\n\n  // Update history\n  if (currentPage !== pageId) {\n    pageHistory.push(currentPage);\n  }\n  currentPage = pageId;\n\n  // Update bottom nav\n  updateBottomNav(pageId);\n\n  // Load page data\n  loadPageData(pageId);\n\n  // Scroll to top\n  window.scrollTo(0, 0);\n}\n\nfunction navigateBack(): void {\n  if (pageHistory.length > 0) {\n    const previousPage = pageHistory.pop() || 'home';\n    currentPage = previousPage;\n    navigateTo(previousPage);\n    pageHistory.pop(); // Remove the page we just navigated to\n  } else {\n    navigateTo('home');\n  }\n}\n\nfunction updateBottomNav(activePage: string): void {\n  document.querySelectorAll('.nav-item').forEach(item => {\n    const page = item.getAttribute('data-page');\n    if (page === activePage) {\n      item.classList.add('active');\n    } else {\n      item.classList.remove('active');\n    }\n  });\n}\n\n// =====================================================\n// UI UPDATES\n// =====================================================\n\nfunction updateGreeting(): void {\n  const greetingEl = document.getElementById('user-greeting');\n  if (greetingEl && currentUser) {\n    greetingEl.textContent = `สวัสดี, ${currentUser.displayName}`;\n  }\n}\n\nfunction showToast(message: string, type: 'success' | 'error' | 'warning' = 'success'): void {\n  const container = document.createElement('div');\n  container.className = 'toast-container';\n\n  const toast = document.createElement('div');\n  toast.className = `toast ${type}`;\n  toast.innerHTML = `<span>${message}</span>`;\n\n  container.appendChild(toast);\n  document.body.appendChild(container);\n\n  setTimeout(() => {\n    toast.remove();\n    container.remove();\n  }, 3000);\n}\n\n// =====================================================\n// DATA LOADING\n// =====================================================\n\nasync function loadPageData(pageId: string): Promise<void> {\n  switch (pageId) {\n    case 'home':\n      await loadHomePage();\n      break;\n    case 'booking':\n      await loadBookingPage();\n      break;\n    case 'queue':\n      await loadQueuePage();\n      break;\n    case 'records':\n      await loadRecordsPage();\n      break;\n    case 'notifications':\n      await loadNotificationsPage();\n      break;\n    case 'profile':\n      await loadProfilePage();\n      break;\n    case 'register':\n      // Registration page doesn't need additional data loading\n      break;\n  }\n}\n\nasync function loadHomePage(): Promise<void> {\n  await Promise.all([\n    loadNextAppointment(),\n    loadMyQueue(),\n    loadNews(),\n  ]);\n}\n\nasync function loadNextAppointment(): Promise<void> {\n  const container = document.getElementById('next-appointment');\n  if (!container) return;\n\n  try {\n    const { data: appointments } = await supabase\n      .from('appointments')\n      .select(`\n        appointment_id,\n        appointment_date,\n        appointment_time,\n        queue_number,\n        status,\n        doctor:doctors(name, specialty)\n      `)\n      .gte('appointment_date', new Date().toISOString().split('T')[0])\n      .in('status', ['pending', 'confirmed'])\n      .order('appointment_date', { ascending: true })\n      .order('appointment_time', { ascending: true })\n      .limit(1);\n\n    if (appointments && appointments.length > 0) {\n      const appointment = appointments[0];\n      container.innerHTML = `\n        <div class=\"appointment-info\">\n          <div class=\"appointment-icon\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <path d=\"M22 12h-4l-3 9-9-5-2-3 3V4a2 2 0 01-2 2v2a2 2 0 012 2z\" />\n              <path d=\"M12 7v5a2 2 0 002 2\" />\n            </svg>\n          </div>\n          <div class=\"appointment-details\">\n            <div class=\"appointment-doctor\">${((appointment.doctor as any)?.[0]?.name || (appointment.doctor as any)?.name) || 'แพทย์'}</div>\n            <div class=\"appointment-datetime\">\n              ${formatDate(appointment.appointment_date)} · ${formatTime(appointment.appointment_time)}\n            </div>\n            <div class=\"appointment-queue\">\n              คิว: ${appointment.queue_number || '-'}\n            </div>\n          </div>\n        </div>\n      `;\n    } else {\n      container.innerHTML = `\n        <div class=\"no-appointment\">\n          <p>ไม่มีนัดหมายที่กำลังจะถึง</p>\n          <button class=\"btn btn-primary mt-sm\" onclick=\"navigateTo('booking')\">\n            จองนัดหมาย\n          </button>\n        </div>\n      `;\n    }\n  } catch (error) {\n    console.error('Error loading appointment:', error);\n  }\n}\n\nasync function loadMyQueue(): Promise<void> {\n  const container = document.getElementById('my-queue');\n  if (!container) return;\n\n  try {\n    const today = new Date().toISOString().split('T')[0];\n\n    const { data: queueData } = await supabase\n      .from('queue_management')\n      .select('*')\n      .eq('date', today)\n      .maybeSingle();\n\n    if (!queueData) {\n      container.innerHTML = `<div class=\"queue-placeholder\"><p>ไม่มีคิววันนี้</p></div>`;\n      return;\n    }\n\n    // Get user's queue for today\n    const { data: myAppointment } = await supabase\n      .from('appointments')\n      .select('queue_number, status, doctor:doctors(name)')\n      .eq('appointment_date', today)\n      .in('status', ['confirmed', 'checked_in', 'in_consultation'])\n      .maybeSingle();\n\n    if (myAppointment) {\n      const waitingAhead = Math.max(0, queueData.current_queue - myAppointment.queue_number);\n      const waitMinutes = waitingAhead * 30;\n\n      container.innerHTML = `\n        <div class=\"queue-status\">\n          <div>\n            <div class=\"text-muted text-sm\">คิวของคุณ</div>\n            <div class=\"queue-current\">${myAppointment.queue_number || '-'}</div>\n          </div>\n          <div class=\"queue-waiting\">\n            <div class=\"queue-waiting-count\">${waitingAhead}</div>\n            <div class=\"queue-waiting-label\">รอ ${waitingAhead} คน</div>\n          </div>\n        </div>\n        <div class=\"queue-estimate\">\n          เวลารอคอยโดยประมาณ ~${waitMinutes} นาที\n          <br>\n          <small>แพทย์: ${((myAppointment.doctor as any)?.[0]?.name || (myAppointment.doctor as any)?.name) || '-'}</small>\n        </div>\n      `;\n    } else {\n      container.innerHTML = `<div class=\"queue-placeholder\"><p>ไม่มีคิววันนี้</p></div>`;\n    }\n  } catch (error) {\n    console.error('Error loading queue:', error);\n  }\n}\n\nasync function loadNews(): Promise<void> {\n  const container = document.getElementById('news-list');\n  if (!container) return;\n\n  try {\n    const { data: articles } = await supabase\n      .from('articles')\n      .select('article_id, title, excerpt, cover_image, created_at')\n      .eq('status', 'published')\n      .order('published_at', { ascending: false, nullsFirst: false })\n      .limit(3);\n\n    if (articles && articles.length > 0) {\n      container.innerHTML = articles.map(article => `\n        <div class=\"news-item\">\n          <img\n            src=\"${article.cover_image || '/placeholder-news.png'}\"\n            alt=\"${article.title}\"\n            class=\"news-image\"\n            onerror=\"this.src='/placeholder-news.png'\"\n          >\n          <div class=\"news-content\">\n            <div class=\"news-title\">${article.title}</div>\n            <div class=\"news-meta\">${formatDate(article.created_at)}</div>\n          </div>\n        </div>\n      `).join('');\n    } else {\n      container.innerHTML = `<p class=\"text-muted text-center\">ไม่มีข่าวสาร</p>`;\n    }\n  } catch (error) {\n    console.error('Error loading news:', error);\n  }\n}\n\nasync function loadBookingPage(): Promise<void> {\n  // Load doctors list\n  const select = document.getElementById('doctor-select') as HTMLSelectElement;\n  if (!select) return;\n\n  try {\n    const { data: doctors } = await supabase\n      .from('doctors')\n      .select('doctor_id, name, title, specialty')\n      .eq('is_available', true)\n      .order('name');\n\n    // Clear existing options except first\n    select.innerHTML = '<option value=\"\">-- กรุณาเลือกแพทย์ --</option>';\n\n    if (doctors && doctors.length > 0) {\n      doctors.forEach(doctor => {\n        const option = document.createElement('option');\n        option.value = doctor.doctor_id;\n        option.textContent = `${doctor.title || ''} ${doctor.name}${doctor.specialty ? ` - ${doctor.specialty}` : ''}`;\n        select.appendChild(option);\n      });\n    }\n\n    // Initialize date selector\n    initializeDateSelector();\n\n    // Add event listeners\n    select.addEventListener('change', handleDoctorChange);\n\n  } catch (error) {\n    console.error('Error loading doctors:', error);\n  }\n}\n\nasync function loadQueuePage(): Promise<void> {\n  // Similar to home queue but with more detail\n  await loadMyQueue();\n}\n\nasync function loadRecordsPage(): Promise<void> {\n  const container = document.getElementById('records-list');\n  if (!container) return;\n\n  try {\n    const { data: records } = await supabase\n      .from('medical_records')\n      .select(`\n        record_id,\n        created_at,\n        diagnosis,\n        treatment_plan,\n        prescription,\n        doctor:doctors(name, title),\n        appointment:appointments(appointment_date)\n      `)\n      .order('created_at', { ascending: false })\n      .limit(10);\n\n    if (records && records.length > 0) {\n      container.innerHTML = records.map(record => `\n        <div class=\"card mb-md\">\n          <div class=\"card-body\">\n            <div class=\"flex justify-between mb-sm\">\n              <strong>${((record.doctor as any)?.[0]?.title || (record.doctor as any)?.title) || ''} ${((record.doctor as any)?.[0]?.name || (record.doctor as any)?.name) || 'แพทย์'}</strong>\n              <span class=\"text-muted\">${formatDate(record.created_at)}</span>\n            </div>\n            <div class=\"mb-sm\">\n              <span class=\"text-muted\">วินิจฉัย:</span>\n              <p>${record.diagnosis || '-'}</p>\n            </div>\n            <div class=\"mb-sm\">\n              <span class=\"text-muted\">การรักษา:</span>\n              <p>${record.treatment_plan || '-'}</p>\n            </div>\n            <div>\n              <span class=\"text-muted\">ยา:</span>\n              <p>${record.prescription || '-'}</p>\n            </div>\n          </div>\n        </div>\n      `).join('');\n    } else {\n      container.innerHTML = `\n        <div class=\"text-center p-lg\">\n          <p class=\"text-muted\">ไม่พบประวัติการรักษา</p>\n        </div>\n      `;\n    }\n  } catch (error) {\n    console.error('Error loading records:', error);\n  }\n}\n\nasync function loadNotificationsPage(): Promise<void> {\n  const container = document.getElementById('notifications-list');\n  if (!container || !currentUser) return;\n\n  try {\n    const { data: notifications } = await supabase\n      .from('notifications')\n      .select('*')\n      .eq('user_id', currentUser.userId)\n      .order('created_at', { ascending: false })\n      .limit(20);\n\n    if (notifications && notifications.length > 0) {\n      container.innerHTML = notifications.map(notification => `\n        <div class=\"card mb-sm ${notification.is_read ? '' : 'unread'}\">\n          <div class=\"card-body\">\n            <div class=\"font-semibold mb-sm\">${notification.title || 'แจ้งเตือน'}</div>\n            <p class=\"text-muted\">${notification.message}</p>\n            <span class=\"text-xs text-muted\">${formatDateTime(notification.created_at)}</span>\n          </div>\n        </div>\n      `).join('');\n    } else {\n      container.innerHTML = `\n        <div class=\"text-center p-lg\">\n          <p class=\"text-muted\">ไม่มีการแจ้งเตือน</p>\n        </div>\n      `;\n    }\n  } catch (error) {\n    console.error('Error loading notifications:', error);\n  }\n}\n\nasync function loadProfilePage(): Promise<void> {\n  const container = document.getElementById('profile-card');\n  if (!container || !currentUser) return;\n\n  try {\n    const { data: patient } = await supabase\n      .from('patients')\n      .select('*')\n      .eq('user_id', currentUser.userId)\n      .maybeSingle();\n\n    container.innerHTML = `\n      <div class=\"text-center mb-lg\">\n        <img\n          src=\"${currentUser.pictureUrl || '/placeholder-avatar.png'}\"\n          alt=\"${currentUser.displayName}\"\n          class=\"profile-avatar\"\n          onerror=\"this.src='/placeholder-avatar.png'\"\n          style=\"width: 100px; height: 100px; border-radius: 50%; object-fit: cover;\"\n        >\n        <h2 class=\"mt-md\">${patient?.name || currentUser.displayName}</h2>\n        <p class=\"text-muted\">${patient?.phone || ''}</p>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-body\">\n          <div class=\"mb-md\">\n            <label class=\"text-muted text-sm\">วันเกิด</label>\n            <p>${patient?.date_of_birth ? formatDate(patient.date_of_birth) : '-'}</p>\n          </div>\n          <div class=\"mb-md\">\n            <label class=\"text-muted text-sm\">กรุ๊ปเลือด</label>\n            <p>${patient?.gender || '-'}</p>\n          </div>\n          <div class=\"mb-md\">\n            <label class=\"text-muted text-sm\">โรคประจำตัว</label>\n            <p>${patient?.chronic_diseases || '-'}</p>\n          </div>\n          <div class=\"mb-md\">\n            <label class=\"text-muted text-sm\">ประวัติแพ้ยา</label>\n            <p>${patient?.allergies || '-'}</p>\n          </div>\n        </div>\n      </div>\n\n      <button class=\"btn btn-outline\" style=\"width: 100%; margin-top: var(--spacing-md);\">\n        แก้ไขข้อมูล\n      </button>\n    `;\n  } catch (error) {\n    console.error('Error loading profile:', error);\n  }\n}\n\n// =====================================================\n// BOOKING PAGE LOGIC\n// =====================================================\n\nfunction initializeDateSelector(): void {\n  const container = document.getElementById('date-selector');\n  if (!container) return;\n\n  const days = ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'];\n  const today = new Date();\n  const dates: Date[] = [];\n\n  // Generate next 14 days\n  for (let i = 0; i < 14; i++) {\n    const date = new Date(today);\n    date.setDate(today.getDate() + i);\n    dates.push(date);\n  }\n\n  container.innerHTML = dates.map(date => {\n    const dateStr = date.toISOString().split('T')[0];\n    const dayName = days[date.getDay()];\n    const dayNumber = date.getDate();\n    const isWeekend = date.getDay() === 0 || date.getDay() === 6;\n\n    return `\n      <button\n        type=\"button\"\n        class=\"date-btn ${isWeekend ? 'weekend' : ''}\"\n        data-date=\"${dateStr}\"\n        ${isWeekend ? 'disabled' : ''}\n        onclick=\"selectDate('${dateStr}')\"\n      >\n        <span class=\"date-day\">${dayName}</span>\n        <span class=\"date-number\">${dayNumber}</span>\n      </button>\n    `;\n  }).join('');\n}\n\n(window as any).selectDate = async (dateStr: string): Promise<void> => {\n  // Update UI\n  document.querySelectorAll('.date-btn').forEach(btn => {\n    btn.classList.remove('selected');\n    if (btn.getAttribute('data-date') === dateStr) {\n      btn.classList.add('selected');\n    }\n  });\n\n  // Update hidden input\n  const dateInput = document.getElementById('selected-date') as HTMLInputElement;\n  if (dateInput) {\n    dateInput.value = dateStr;\n  }\n\n  // Load time slots\n  await loadTimeSlots(dateStr);\n};\n\nasync function loadTimeSlots(date: string): Promise<void> {\n  const container = document.getElementById('time-selector');\n  const doctorSelect = document.getElementById('doctor-select') as HTMLSelectElement;\n  if (!container || !doctorSelect) return;\n\n  const doctorId = doctorSelect.value;\n  if (!doctorId) {\n    container.innerHTML = `<p class=\"text-muted\">กรุณาเลือกแพทย์ก่อน</p>`;\n    return;\n  }\n\n  try {\n    // Get doctor's available time\n    const { data: doctor } = await supabase\n      .from('doctors')\n      .select('available_time_start, available_time_end, appointment_duration_minutes')\n      .eq('doctor_id', doctorId)\n      .maybeSingle();\n\n    const startTime = doctor?.available_time_start || '09:00';\n    const endTime = doctor?.available_time_end || '17:00';\n    const duration = doctor?.appointment_duration_minutes || 30;\n\n    // Generate time slots\n    const slots = generateTimeSlots(startTime, endTime, duration);\n\n    // Get booked slots\n    const { data: bookedSlots } = await supabase\n      .from('appointment_slots')\n      .select('start_time')\n      .eq('doctor_id', doctorId)\n      .eq('date', date)\n      .eq('is_available', false);\n\n    const bookedTimes = new Set(bookedSlots?.map(s => s.start_time) || []);\n\n    container.innerHTML = slots.map(slot => {\n      const isBooked = bookedTimes.has(slot);\n      return `\n        <button\n          type=\"button\"\n          class=\"time-btn\"\n          data-time=\"${slot}\"\n          ${isBooked ? 'disabled' : ''}\n          onclick=\"selectTime('${slot}')\"\n        >\n          ${slot}\n        </button>\n      `;\n    }).join('');\n\n  } catch (error) {\n    console.error('Error loading time slots:', error);\n  }\n}\n\nfunction generateTimeSlots(start: string, end: string, duration: number): string[] {\n  const slots: string[] = [];\n  let [startHour, startMin] = start.split(':').map(Number);\n  const [endHour, endMin] = end.split(':').map(Number);\n\n  while (startHour < endHour || (startHour === endHour && startMin < endMin)) {\n    const timeStr = `${String(startHour).padStart(2, '0')}:${String(startMin).padStart(2, '0')}`;\n    slots.push(timeStr);\n\n    // Add duration\n    startMin += duration;\n    if (startMin >= 60) {\n      startHour += Math.floor(startMin / 60);\n      startMin = startMin % 60;\n    }\n  }\n\n  return slots;\n}\n\n(window as any).selectTime = (timeStr: string): void => {\n  // Update UI\n  document.querySelectorAll('.time-btn').forEach(btn => {\n    btn.classList.remove('selected');\n    if (btn.getAttribute('data-time') === timeStr) {\n      btn.classList.add('selected');\n    }\n  });\n\n  // Update hidden input\n  const timeInput = document.getElementById('selected-time') as HTMLInputElement;\n  if (timeInput) {\n    timeInput.value = timeStr;\n  }\n};\n\nasync function handleDoctorChange(): Promise<void> {\n  const dateInput = document.getElementById('selected-date') as HTMLInputElement;\n  if (dateInput.value) {\n    await loadTimeSlots(dateInput.value);\n  }\n}\n\n// =====================================================\n// REGISTRATION\n// =====================================================\n\ninterface Patient {\n  patient_id: string;\n  user_id?: string;\n  line_user_id?: string;\n  phone: string;\n  id_card_number: string;\n  name: string;\n  date_of_birth?: string;\n  gender?: string;\n  chronic_diseases?: string;\n  allergies?: string;\n}\n\nasync function checkUserRegistration(lineUserId: string): Promise<Patient | null> {\n  try {\n    // First check if there's a users record with this LINE user_id\n    const { data: user } = await supabase\n      .from('users')\n      .select('user_id')\n      .eq('line_user_id', lineUserId)\n      .maybeSingle();\n\n    if (user) {\n      // User exists, check for patient record\n      const { data: patient } = await supabase\n        .from('patients')\n        .select('*')\n        .eq('user_id', user.user_id)\n        .maybeSingle();\n\n      return patient;\n    }\n\n    // No user record found\n    return null;\n  } catch (error) {\n    console.error('Error checking registration:', error);\n    return null;\n  }\n}\n\nasync function handleRegistrationSubmit(e: Event): Promise<void> {\n  e.preventDefault();\n\n  if (!currentUser) {\n    showToast('ไม่พบข้อมูลผู้ใช้', 'error');\n    return;\n  }\n\n  const phoneInput = document.getElementById('reg-phone') as HTMLInputElement;\n  const idCardInput = document.getElementById('reg-id-card') as HTMLInputElement;\n  const nameInput = document.getElementById('reg-name') as HTMLInputElement;\n  const dobInput = document.getElementById('reg-dob') as HTMLInputElement;\n  const chronicInput = document.getElementById('reg-chronic') as HTMLTextAreaElement;\n  const allergiesInput = document.getElementById('reg-allergies') as HTMLTextAreaElement;\n\n  // Get selected gender\n  const genderInput = document.querySelector('input[name=\"reg-gender\"]:checked') as HTMLInputElement;\n\n  // Validation\n  if (!phoneInput.value || !idCardInput.value || !nameInput.value) {\n    showToast('กรุณากรอกข้อมูลให้ครบถ้วน', 'warning');\n    return;\n  }\n\n  // Validate phone number (Thai format: 10 digits starting with 0)\n  const phoneRegex = /^0[0-9]{8,9}$/;\n  const cleanPhone = phoneInput.value.replace(/-/g, '');\n  if (!phoneRegex.test(cleanPhone)) {\n    showToast('กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง', 'warning');\n    return;\n  }\n\n  // Validate ID card (13 digits for Thai ID)\n  const idCardRegex = /^[0-9]{13}$/;\n  const cleanIdCard = idCardInput.value.replace(/-/g, '');\n  if (!idCardRegex.test(cleanIdCard)) {\n    showToast('กรุณากรอกเลขบัตรประชาชน 13 หลัก', 'warning');\n    return;\n  }\n\n  try {\n    // Check if ID card already exists\n    const { data: existingPatient } = await supabase\n      .from('patients')\n      .select('patient_id')\n      .eq('id_card_number', cleanIdCard)\n      .maybeSingle();\n\n    if (existingPatient) {\n      showToast('เลขบัตรประชาชนนี้ได้ถูกลงทะเบียนแล้ว', 'error');\n      return;\n    }\n\n    // First create or get the user record\n    let userId: string | undefined;\n\n    const { data: existingUser } = await supabase\n      .from('users')\n      .select('user_id')\n      .eq('line_user_id', currentUser.userId)\n      .maybeSingle();\n\n    if (existingUser) {\n      userId = existingUser.user_id;\n    } else {\n      // Create new user record\n      const { data: newUser, error: userError } = await supabase\n        .from('users')\n        .insert({\n          line_user_id: currentUser.userId,\n          display_name: currentUser.displayName,\n          picture_url: currentUser.pictureUrl,\n          phone: cleanPhone,\n          role: 'patient',\n        })\n        .select('user_id')\n        .single();\n\n      if (userError) {\n        // If we can't create a user (due to RLS), try to insert patient without user_id\n        console.warn('Could not create user record, proceeding with patient only:', userError);\n      } else {\n        userId = newUser.user_id;\n      }\n    }\n\n    // Now create the patient record\n    const { data: newPatient, error } = await supabase\n      .from('patients')\n      .insert({\n        user_id: userId,\n        clinic_id: '00000000-0000-0000-0000-000000000001', // Demo clinic\n        phone: cleanPhone,\n        id_card_number: cleanIdCard,\n        name: nameInput.value.trim(),\n        date_of_birth: dobInput.value || null,\n        gender: genderInput?.value || null,\n        chronic_diseases: chronicInput?.value.trim() || null,\n        allergies: allergiesInput?.value.trim() || null,\n        first_visit_date: new Date().toISOString().split('T')[0],\n      })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Patient insert error:', error);\n      throw error;\n    }\n\n    showToast('ลงทะเบียนสำเร็จ', 'success');\n\n    // Reset form\n    (document.getElementById('registration-form') as HTMLFormElement).reset();\n\n    // Navigate to home page\n    navigateTo('home');\n    await loadHomePage();\n\n  } catch (error) {\n    console.error('Registration error:', error);\n    showToast('ไม่สามารถลงทะเบียนได้ กรุณาลองใหม่', 'error');\n  }\n}\n\n(window as any).cancelRegistration = function(): void {\n  // If user cancels registration, show a warning and redirect to login or exit\n  if (confirm('คุณต้องการยกเลิกการลงทะเบียนใช่หรือไม่?')) {\n    if (liff.isInClient()) {\n      liff.closeWindow();\n    } else {\n      navigateTo('home');\n    }\n  }\n};\n\n// =====================================================\n// FORM SUBMISSION\n// =====================================================\n\nasync function handleBookingSubmit(e: Event): Promise<void> {\n  e.preventDefault();\n\n  const doctorSelect = document.getElementById('doctor-select') as HTMLSelectElement;\n  const dateInput = document.getElementById('selected-date') as HTMLInputElement;\n  const timeInput = document.getElementById('selected-time') as HTMLInputElement;\n  const symptomsInput = document.getElementById('symptoms') as HTMLTextAreaElement;\n\n  if (!doctorSelect.value || !dateInput.value || !timeInput.value) {\n    showToast('กรุณากรอกข้อมูลให้ครบถ้วน', 'warning');\n    return;\n  }\n\n  try {\n    // Create appointment\n    const { data: appointment, error } = await supabase\n      .from('appointments')\n      .insert({\n        clinic_id: '00000000-0000-0000-0000-000000000001', // Demo clinic\n        patient_id: null, // Will be set by RLS or server\n        doctor_id: doctorSelect.value,\n        appointment_date: dateInput.value,\n        appointment_time: timeInput,\n        symptoms: symptomsInput.value,\n        status: 'pending',\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    showToast('จองนัดหมายสำเร็จ', 'success');\n\n    // Reset form and go back to home\n    (document.getElementById('booking-form') as HTMLFormElement).reset();\n    navigateTo('home');\n\n  } catch (error) {\n    console.error('Booking error:', error);\n    showToast('ไม่สามารถจองนัดหมายได้', 'error');\n  }\n}\n\n// =====================================================\n// UTILITY FUNCTIONS\n// =====================================================\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  const options: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n  };\n  return date.toLocaleDateString('th-TH', options);\n}\n\nfunction formatTime(timeStr: string): string {\n  const [hours, minutes] = timeStr.split(':');\n  return `${hours}:${minutes}`;\n}\n\nfunction formatDateTime(dateStr: string): string {\n  const date = new Date(dateStr);\n  const options: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  };\n  return date.toLocaleDateString('th-TH', options);\n}\n\n// =====================================================\n// INIT\n// =====================================================\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  // Initialize LIFF\n  initializeLiff();\n\n  // Setup form submission\n  const bookingForm = document.getElementById('booking-form');\n  if (bookingForm) {\n    bookingForm.addEventListener('submit', handleBookingSubmit);\n  }\n\n  // Setup registration form submission\n  const registrationForm = document.getElementById('registration-form');\n  if (registrationForm) {\n    registrationForm.addEventListener('submit', handleRegistrationSubmit);\n  }\n});\n\n// Export functions for global scope\n(window as any).navigateTo = navigateTo;\n(window as any).navigateBack = navigateBack;\n"],"names":["SUPABASE_URL","SUPABASE_ANON_KEY","LINE_LIFF_ID","currentUser","currentPage","pageHistory","supabase","createClient","initializeLiff","__async","liff","profile","_a","_b","updateGreeting","checkUserRegistration","navigateTo","loadHomePage","error","_c","_d","showToast","pageId","page","targetPage","updateBottomNav","loadPageData","navigateBack","previousPage","activePage","item","greetingEl","message","type","container","toast","loadBookingPage","loadQueuePage","loadRecordsPage","loadNotificationsPage","loadProfilePage","loadNextAppointment","loadMyQueue","loadNews","appointments","appointment","formatDate","formatTime","today","queueData","myAppointment","waitingAhead","waitMinutes","articles","article","select","doctors","doctor","option","initializeDateSelector","handleDoctorChange","records","record","_e","_f","notifications","notification","formatDateTime","patient","days","dates","i","date","dateStr","dayName","dayNumber","isWeekend","exports","btn","dateInput","loadTimeSlots","doctorSelect","doctorId","startTime","endTime","duration","slots","generateTimeSlots","bookedSlots","bookedTimes","s","slot","isBooked","start","end","startHour","startMin","endHour","endMin","timeStr","timeInput","lineUserId","user","handleRegistrationSubmit","e","phoneInput","idCardInput","nameInput","dobInput","chronicInput","allergiesInput","genderInput","phoneRegex","cleanPhone","idCardRegex","cleanIdCard","existingPatient","userId","existingUser","newUser","userError","newPatient","handleBookingSubmit","symptomsInput","options","hours","minutes","bookingForm","registrationForm"],"mappings":"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"}