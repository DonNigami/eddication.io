{"version":3,"file":"index-CMiPeaP0.js","sources":["../../src/main.ts"],"sourcesContent":["/**\n * ClinicConnect - LIFF Doctor App Main Entry Point\n */\n\nimport { liff } from '@line/liff';\nimport { createClient } from '@supabase/supabase-js';\nimport { AppointmentStatus } from '@clinic/config';\n\n// =====================================================\n// ENVIRONMENT VARIABLES\n// =====================================================\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || '';\nconst SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || '';\nconst LINE_LIFF_ID = import.meta.env.VITE_LINE_LIFF_ID_DOCTOR || import.meta.env.VITE_LINE_LIFF_ID || '';\n\n// =====================================================\n// TYPES\n// =====================================================\n\ninterface DoctorProfile {\n  doctor_id: string;\n  name: string;\n  title: string;\n  specialty: string;\n  clinic_id: string;\n  rating_average?: number;\n}\n\ninterface QueueItem {\n  appointment_id: string;\n  queue_number: number;\n  status: AppointmentStatus;\n  patient: Array<{ name: string; phone: string }>;\n  appointment_time: string;\n  symptoms: string;\n}\n\ninterface Patient {\n  patient_id: string;\n  name: string;\n  phone: string;\n  last_visit_date?: string;\n  total_visits: number;\n}\n\n// =====================================================\n// STATE\n// =====================================================\n\nlet currentDoctor: DoctorProfile | null = null;\nlet currentPage: string = 'dashboard';\nlet pageHistory: string[] = [];\nlet currentPatientId: string | null = null;\n\nconst supabase = createClient(\n  SUPABASE_URL,\n  SUPABASE_ANON_KEY\n);\n\n// =====================================================\n// LIFF INITIALIZATION\n// =====================================================\n\nasync function initializeLiff(): Promise<void> {\n  try {\n    await liff.init({ liffId: LINE_LIFF_ID });\n\n    if (!liff.isLoggedIn()) {\n      liff.login();\n      return;\n    }\n\n    const profile = liff.getDecodedIDToken();\n\n    // Hide loading, show app\n    document.getElementById('loading-screen')?.classList.add('hidden');\n    document.getElementById('main-app')?.classList.remove('hidden');\n\n    // Load doctor profile\n    await loadDoctorProfile(profile.sub);\n\n    // Load initial data\n    await loadDashboard();\n\n  } catch (error) {\n    console.error('LIFF initialization failed:', error);\n    showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ', 'error');\n  }\n}\n\nasync function loadDoctorProfile(lineUserId: string): Promise<void> {\n  try {\n    const { data } = await supabase\n      .from('doctors')\n      .select('*, clinic_id')\n      .eq('user_id', lineUserId)\n      .single();\n\n    if (data) {\n      currentDoctor = data;\n      updateGreeting();\n    } else {\n      showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏û‡∏ó‡∏¢‡πå', 'error');\n    }\n  } catch (error) {\n    console.error('Error loading doctor profile:', error);\n  }\n}\n\nfunction updateGreeting(): void {\n  const greetingEl = document.getElementById('user-greeting');\n  if (greetingEl && currentDoctor) {\n    greetingEl.textContent = `üë®‚Äç‚öïÔ∏è ${currentDoctor.title || ''} ${currentDoctor.name}`;\n  }\n}\n\n// =====================================================\n// NAVIGATION\n// =====================================================\n\nfunction navigateTo(pageId: string): void {\n  document.querySelectorAll('.page').forEach(page => {\n    page.classList.remove('active');\n  });\n\n  const targetPage = document.getElementById(`page-${pageId}`);\n  if (targetPage) {\n    targetPage.classList.add('active');\n  }\n\n  if (currentPage !== pageId) {\n    pageHistory.push(currentPage);\n  }\n  currentPage = pageId;\n\n  updateBottomNav(pageId);\n  loadPageData(pageId);\n  window.scrollTo(0, 0);\n}\n\nfunction navigateBack(): void {\n  if (pageHistory.length > 0) {\n    const previousPage = pageHistory.pop() || 'dashboard';\n    currentPage = previousPage;\n    navigateTo(previousPage);\n    pageHistory.pop();\n  } else {\n    navigateTo('dashboard');\n  }\n}\n\nfunction updateBottomNav(activePage: string): void {\n  document.querySelectorAll('.nav-item').forEach(item => {\n    const page = item.getAttribute('data-page');\n    if (page === activePage) {\n      item.classList.add('active');\n    } else {\n      item.classList.remove('active');\n    }\n  });\n}\n\nasync function loadPageData(pageId: string): Promise<void> {\n  switch (pageId) {\n    case 'dashboard':\n      await loadDashboard();\n      break;\n    case 'queue':\n      await loadQueueList();\n      break;\n    case 'patients':\n      await loadPatientsList();\n      break;\n    case 'schedule':\n      await loadSchedule();\n      break;\n    case 'diagnosis':\n      // Loaded when opening a specific patient\n      break;\n  }\n}\n\n// =====================================================\n// DASHBOARD\n// =====================================================\n\nasync function loadDashboard(): Promise<void> {\n  if (!currentDoctor) return;\n\n  const today = new Date().toISOString().split('T')[0];\n\n  try {\n    // Get today's stats\n    const { data: queueData } = await supabase\n      .from('queue_management')\n      .select('*')\n      .eq('doctor_id', currentDoctor.doctor_id)\n      .eq('date', today)\n      .single();\n\n    // Get today's appointments\n    const { data: appointments } = await supabase\n      .from('appointments')\n      .select(`\n        appointment_id,\n        queue_number,\n        status,\n        patient:patients(name, phone),\n        appointment_time\n      `)\n      .eq('doctor_id', currentDoctor.doctor_id)\n      .eq('appointment_date', today)\n      .in('status', ['confirmed', 'checked_in', 'in_consultation'])\n      .order('appointment_time');\n\n    // Update stats\n    document.getElementById('stat-today-patients')!.textContent = queueData?.waiting_count || 0;\n    document.getElementById('stat-waiting')!.textContent = queueData?.waiting_count || 0;\n    document.getElementById('stat-completed')!.textContent = queueData?.completed_count || 0;\n    document.getElementById('stat-rating')!.textContent = `‚≠ê ${currentDoctor.rating_average || 0}`;\n\n    // Update queue list\n    const queueList = document.getElementById('dashboard-queue-list');\n    if (queueList) {\n      if (appointments && appointments.length > 0) {\n        queueList.innerHTML = appointments.slice(0, 5).map(apt => `\n          <div class=\"queue-item ${apt.status === 'in_consultation' ? 'active' : ''}\" data-id=\"${apt.appointment_id}\">\n            <div class=\"queue-item-header\">\n              <span class=\"queue-number\">‡∏Ñ‡∏¥‡∏ß ${apt.queue_number}</span>\n              <span class=\"queue-status status-${apt.status}\">${getStatusText(apt.status)}</span>\n            </div>\n            <div class=\"queue-item-body\">\n              <div class=\"patient-name\">${(apt.patient as any)?.[0]?.name || (apt.patient as any)?.name || '-'}</div>\n              <div class=\"patient-phone\">${(apt.patient as any)?.[0]?.phone || (apt.patient as any)?.phone || ''}</div>\n            </div>\n            <div class=\"queue-item-actions\">\n              ${apt.status === 'confirmed' || apt.status === 'checked_in' ? `\n                <button class=\"btn-sm btn-primary\" onclick=\"startConsultation('${apt.appointment_id}')\">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö</button>\n                <button class=\"btn-sm btn-outline\" onclick=\"openDiagnosis('${apt.appointment_id}')\">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>\n              ` : ''}\n              ${apt.status === 'in_consultation' ? `\n                <button class=\"btn-sm btn-success\" onclick=\"completeConsultation('${apt.appointment_id}')\">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>\n              ` : ''}\n            </div>\n          </div>\n        `).join('');\n      } else {\n        queueList.innerHTML = '<p class=\"text-muted text-center py-4\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';\n      }\n    }\n\n  } catch (error) {\n    console.error('Error loading dashboard:', error);\n  }\n}\n\n// =====================================================\n// QUEUE PAGE\n// =====================================================\n\nasync function loadQueueList(): Promise<void> {\n  if (!currentDoctor) return;\n\n  const today = new Date().toISOString().split('T')[0];\n  const container = document.getElementById('queue-list');\n\n  try {\n    const { data: appointments } = await supabase\n      .from('appointments')\n      .select(`\n        appointment_id,\n        queue_number,\n        status,\n        patient:patients(name, phone),\n        appointment_time,\n        symptoms\n      `)\n      .eq('doctor_id', currentDoctor.doctor_id)\n      .eq('appointment_date', today)\n      .order('queue_number');\n\n    if (container) {\n      if (appointments && appointments.length > 0) {\n        container.innerHTML = appointments.map(apt => `\n          <div class=\"queue-item-full\">\n            <div class=\"queue-item-full-header\">\n              <div class=\"queue-number-large\">A${apt.queue_number}</div>\n              <div class=\"queue-info\">\n                <div class=\"patient-name\">${(apt.patient as any)?.[0]?.name || (apt.patient as any)?.name || '-'}</div>\n                <div class=\"patient-phone\">${(apt.patient as any)?.[0]?.phone || (apt.patient as any)?.phone || ''}</div>\n                ${apt.symptoms ? `<div class=\"symptoms text-muted\">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: ${apt.symptoms}</div>` : ''}\n              </div>\n              <div class=\"queue-status-badge status-${apt.status}\">\n                ${getStatusText(apt.status)}\n              </div>\n            </div>\n            <div class=\"queue-item-full-actions\">\n              ${apt.status === 'confirmed' ? `\n                <button class=\"btn btn-outline\" onclick=\"callQueue('${apt.appointment_id}')\">üîî ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß</button>\n                <button class=\"btn btn-primary\" onclick=\"openDiagnosis('${apt.appointment_id}')\">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>\n              ` : ''}\n              ${apt.status === 'checked_in' ? `\n                <button class=\"btn btn-success\" onclick=\"startConsultation('${apt.appointment_id}')\">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö</button>\n              ` : ''}\n              ${apt.status === 'in_consultation' ? `\n                <button class=\"btn btn-success\" onclick=\"completeConsultation('${apt.appointment_id}')\">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>\n              ` : ''}\n            </div>\n          </div>\n        `).join('');\n      } else {\n        container.innerHTML = '<p class=\"text-muted text-center py-8\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>';\n      }\n    }\n\n  } catch (error) {\n    console.error('Error loading queue:', error);\n  }\n}\n\n// =====================================================\n// PATIENTS PAGE\n// =====================================================\n\nasync function loadPatientsList(): Promise<void> {\n  const container = document.getElementById('patients-list');\n  if (!container || !currentDoctor) return;\n\n  try {\n    const { data: patients } = await supabase\n      .from('patients')\n      .select('*')\n      .eq('clinic_id', currentDoctor.clinic_id)\n      .order('last_visit_date', { ascending: false, nullsFirst: false })\n      .limit(50);\n\n    if (container) {\n      if (patients && patients.length > 0) {\n        container.innerHTML = patients.map(patient => `\n          <div class=\"patient-item\" onclick=\"openPatientDetail('${patient.patient_id}')\">\n            <div class=\"patient-item-header\">\n              <div class=\"patient-name\">${patient.name}</div>\n              <div class=\"patient-visits\">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤ ${patient.total_visits} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>\n            </div>\n            <div class=\"patient-item-body\">\n              <div class=\"patient-phone\">üì± ${patient.phone}</div>\n              ${patient.chronic_diseases ? `<div class=\"patient-conditions\">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${patient.chronic_diseases}</div>` : ''}\n            </div>\n          </div>\n        `).join('');\n      } else {\n        container.innerHTML = '<p class=\"text-muted text-center py-8\">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ</p>';\n      }\n    }\n\n  } catch (error) {\n    console.error('Error loading patients:', error);\n  }\n}\n\n// =====================================================\n// SCHEDULE PAGE\n// =====================================================\n\nasync function loadSchedule(): Promise<void> {\n  if (!currentDoctor) return;\n\n  try {\n    const { data: doctor } = await supabase\n      .from('doctors')\n      .select('*')\n      .eq('doctor_id', currentDoctor.doctor_id)\n      .single();\n\n    if (doctor) {\n      // Set form values\n      const startInput = document.getElementById('schedule-start') as HTMLInputElement;\n      const endInput = document.getElementById('schedule-end') as HTMLInputElement;\n      const durationInput = document.getElementById('schedule-duration') as HTMLInputElement;\n      const breakStartInput = document.getElementById('schedule-break-start') as HTMLInputElement;\n      const breakEndInput = document.getElementById('schedule-break-end') as HTMLInputElement;\n\n      if (startInput) startInput.value = doctor.available_time_start || '09:00';\n      if (endInput) endInput.value = doctor.available_time_end || '17:00';\n      if (durationInput) durationInput.value = doctor.appointment_duration_minutes || 30;\n      if (breakStartInput) breakStartInput.value = doctor.break_start_time || '12:00';\n      if (breakEndInput) breakEndInput.value = doctor.break_end_time || '13:00';\n\n      // Set working days checkboxes\n      const days = doctor.available_days || [1, 2, 3, 4, 5];\n      document.querySelectorAll('.day-checkbox input').forEach((checkbox: HTMLInputElement) => {\n        checkbox.checked = days.includes(parseInt(checkbox.value));\n      });\n\n      // Load blocked dates\n      await loadBlockedDates();\n    }\n\n  } catch (error) {\n    console.error('Error loading schedule:', error);\n  }\n}\n\nasync function loadBlockedDates(): Promise<void> {\n  if (!currentDoctor) return;\n\n  const container = document.getElementById('blocked-dates');\n  if (!container) return;\n\n  try {\n    const { data: blockedDates } = await supabase\n      .from('doctor_blocked_dates')\n      .select('*')\n      .eq('doctor_id', currentDoctor.doctor_id)\n      .gte('block_date', new Date().toISOString().split('T')[0])\n      .order('block_date')\n      .limit(10);\n\n    if (container) {\n      if (blockedDates && blockedDates.length > 0) {\n        container.innerHTML = blockedDates.map(date => `\n          <div class=\"blocked-date-item\">\n            <span>${formatDate(date.block_date)}</span>\n            <span class=\"text-muted\">${date.reason || date.block_type}</span>\n            <button class=\"text-btn text-error\" onclick=\"unblockDate('${date.block_id}')\">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>\n          </div>\n        `).join('');\n      } else {\n        container.innerHTML = '<p class=\"text-muted text-sm\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏Å</p>';\n      }\n    }\n  } catch (error) {\n    console.error('Error loading blocked dates:', error);\n  }\n}\n\n// =====================================================\n// QUEUE ACTIONS\n// =====================================================\n\nasync function callQueue(appointmentId: string): Promise<void> {\n  try {\n    await supabase\n      .from('appointments')\n      .update({ status: 'checked_in', check_in_time: new Date().toISOString() })\n      .eq('appointment_id', appointmentId);\n\n    // Update queue management\n    await updateQueueManagement('checked_in');\n\n    showToast('‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß');\n    await loadPageData(currentPage);\n\n  } catch (error) {\n    console.error('Error calling queue:', error);\n    showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏î‡πâ', 'error');\n  }\n}\n\nasync function startConsultation(appointmentId: string): Promise<void> {\n  try {\n    await supabase\n      .from('appointments')\n      .update({ status: 'in_consultation', start_time: new Date().toISOString() })\n      .eq('appointment_id', appointmentId);\n\n    showToast('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß');\n    openDiagnosis(appointmentId);\n    await loadPageData(currentPage);\n\n  } catch (error) {\n    console.error('Error starting consultation:', error);\n    showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏î‡πâ', 'error');\n  }\n}\n\nasync function completeConsultation(appointmentId: string): Promise<void> {\n  try {\n    await supabase\n      .from('appointments')\n      .update({\n        status: 'completed',\n        end_time_actual: new Date().toISOString(),\n      })\n      .eq('appointment_id', appointmentId);\n\n    await updateQueueManagement('completed');\n\n    showToast('‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß');\n    await loadPageData(currentPage);\n\n  } catch (error) {\n    console.error('Error completing consultation:', error);\n    showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ', 'error');\n  }\n}\n\nasync function updateQueueManagement(status: string): Promise<void> {\n  if (!currentDoctor) return;\n\n  const today = new Date().toISOString().split('T')[0];\n\n  const updates: any = {\n    updated_at: new Date().toISOString(),\n  };\n\n  if (status === 'checked_in') {\n    updates.last_called_at = new Date().toISOString();\n  } else if (status === 'completed') {\n    updates.completed_count = 1;\n  }\n\n  await supabase.rpc('increment_queue_stat', {\n    p_doctor_id: currentDoctor.doctor_id,\n    p_date: today,\n    p_stat_type: status,\n  });\n}\n\n// =====================================================\n// DIAGNOSIS PAGE\n// =====================================================\n\nasync function openDiagnosis(appointmentId: string): Promise<void> {\n  currentPatientId = appointmentId;\n\n  // Load appointment details\n  await loadDiagnosisDetails(appointmentId);\n  navigateTo('diagnosis');\n}\n\nasync function loadDiagnosisDetails(appointmentId: string): Promise<void> {\n  try {\n    const { data: appointment } = await supabase\n      .from('appointments')\n      .select(`\n        patient:patients(name, phone, date_of_birth),\n        appointment_time,\n        symptoms\n      `)\n      .eq('appointment_id', appointmentId)\n      .single();\n\n    if (appointment) {\n      const nameEl = document.getElementById('diagnosis-patient-name');\n      const infoEl = document.getElementById('diagnosis-patient-info');\n\n      const patientData = (appointment.patient as any)?.[0] || (appointment.patient as any);\n      if (nameEl) nameEl.textContent = patientData?.name || '-';\n      if (infoEl) {\n        infoEl.textContent = `‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${patientData?.phone || '-'} | ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î: ${appointment.appointment_time}`;\n      }\n\n      // Pre-fill symptoms\n      const symptomsInput = document.getElementById('diagnosis-subj') as HTMLTextAreaElement;\n      if (symptomsInput) symptomsInput.value = appointment.symptoms || '';\n    }\n\n  } catch (error) {\n    console.error('Error loading diagnosis details:', error);\n  }\n}\n\n// =====================================================\n// UTILITY FUNCTIONS\n// =====================================================\n\nfunction getStatusText(status: string): string {\n  const labels: Record<string, string> = {\n    pending: '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',\n    confirmed: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',\n    checked_in: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô',\n    in_consultation: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à',\n    completed: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',\n    cancelled: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',\n    no_show: '‡πÑ‡∏°‡πà‡∏°‡∏≤',\n  };\n  return labels[status] || status;\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('th-TH', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n  });\n}\n\nfunction showToast(message: string, type: 'success' | 'error' = 'success'): void {\n  const container = document.createElement('div');\n  container.className = 'toast-container';\n\n  const toast = document.createElement('div');\n  toast.className = `toast ${type}`;\n  toast.innerHTML = `<span>${message}</span>`;\n\n  container.appendChild(toast);\n  document.body.appendChild(container);\n\n  setTimeout(() => {\n    toast.remove();\n    container.remove();\n  }, 3000);\n}\n\n// Export functions for global scope\n(window as any).navigateTo = navigateTo;\n(window as any).navigateBack = navigateBack;\n(window as any).callQueue = callQueue;\n(window as any).startConsultation = startConsultation;\n(window as any).completeConsultation = completeConsultation;\n(window as any).openDiagnosis = openDiagnosis;\n\n// =====================================================\n// INIT\n// =====================================================\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  initializeLiff();\n\n  // Setup schedule form\n  const scheduleForm = document.getElementById('schedule-form');\n  if (scheduleForm) {\n    scheduleForm.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      // Handle schedule save\n      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');\n    });\n  }\n\n  // Setup diagnosis form\n  const diagnosisForm = document.getElementById('diagnosis-form');\n  if (diagnosisForm) {\n    diagnosisForm.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      // Handle diagnosis save\n      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');\n      navigateBack();\n    });\n  }\n\n  // Setup patient search\n  const searchInput = document.getElementById('patient-search');\n  if (searchInput) {\n    searchInput.addEventListener('input', async (e) => {\n      const query = (e.target as HTMLInputElement).value;\n      // Implement search\n    });\n  }\n});\n"],"names":["SUPABASE_URL","SUPABASE_ANON_KEY","LINE_LIFF_ID","currentDoctor","currentPage","pageHistory","supabase","createClient","initializeLiff","__async","liff","profile","_a","_b","loadDoctorProfile","loadDashboard","error","showToast","lineUserId","data","updateGreeting","greetingEl","navigateTo","pageId","page","targetPage","updateBottomNav","loadPageData","navigateBack","previousPage","activePage","item","loadQueueList","loadPatientsList","loadSchedule","today","queueData","appointments","queueList","apt","getStatusText","_c","_e","_d","_f","container","patients","patient","doctor","startInput","endInput","durationInput","breakStartInput","breakEndInput","days","checkbox","loadBlockedDates","blockedDates","date","formatDate","callQueue","appointmentId","updateQueueManagement","startConsultation","openDiagnosis","completeConsultation","status","loadDiagnosisDetails","appointment","nameEl","infoEl","patientData","symptomsInput","dateStr","message","type","toast","scheduleForm","e","exports","diagnosisForm","searchInput"],"mappings":"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"}