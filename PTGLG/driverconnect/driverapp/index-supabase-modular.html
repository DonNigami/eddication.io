<!DOCTYPE html>
<html lang="th">

<head>
  <base target="_top" />
  <meta charset="UTF-8" />
  <title>Driver Tracking (Supabase - Modular)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Styles from index-test-20260115.html -->
  <style>
    :root {
      --primary: #1abc9c;
      --primary-dark: #16a085;
      --bg: #f4f8f7;
      --text-main: #222;
      --text-sub: #666;
      --card-bg: #ffffff;
      --border-radius: 14px;
      --input-bg: #f7faf9;
      --input-border: #dce2e0;
      --shadow-color: rgba(0, 0, 0, 0.06);
      --timeline-border: #e4ece9;
      --timeline-bg: #f7faf9;
    }

    /* Dark Mode */
    [data-theme="dark"] {
      --bg: #1a1a2e;
      --text-main: #eaeaea;
      --text-sub: #a0a0a0;
      --card-bg: #16213e;
      --input-bg: #1a1a2e;
      --input-border: #2a2a4a;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --timeline-border: #2a2a4a;
      --timeline-bg: #1a1a2e;
    }

    [data-theme="dark"] .badge {
      background: rgba(26, 188, 156, 0.2);
    }

    [data-theme="dark"] .summary-card {
      background: var(--timeline-bg);
      border-color: var(--timeline-border);
    }

    [data-theme="dark"] .timeline-content {
      background: var(--card-bg);
      border-color: var(--timeline-border);
    }

    [data-theme="dark"] .gps-status.checking {
      background: rgba(52, 152, 219, 0.15);
    }

    [data-theme="dark"] .gps-status.good {
      background: rgba(26, 188, 156, 0.15);
    }

    [data-theme="dark"] .gps-status.weak {
      background: rgba(243, 156, 18, 0.15);
    }

    [data-theme="dark"] .gps-status.error {
      background: rgba(231, 76, 60, 0.15);
    }

    [data-theme="dark"] .last-updated {
      background: rgba(26, 188, 156, 0.12);
    }

    [data-theme="dark"] .ptr-indicator {
      background: var(--card-bg);
    }

    [data-theme="dark"] .inline-flex {
      background: var(--card-bg);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 12px;
      position: relative;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 520px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 16px 18px 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .title {
      font-size: 1.2rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .realtime-dot {
      width: 9px;
      height: 9px;
      background-color: #2ecc71;
      border-radius: 50%;
      display: inline-block;
      box-shadow: 0 0 0 0 rgba(46, 204, 113, 1);
      transform: scale(1);
      animation: pulse-green 2s infinite;
      display:none; /* Initially hidden */
    }

    .realtime-dot.connected {
       display: inline-block;
    }

    @keyframes pulse-green {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
      }
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 5px rgba(46, 204, 113, 0);
      }
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
      }
    }


    .badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(26, 188, 156, 0.1);
      color: var(--primary-dark);
    }
    .badge.supabase {
        background: rgba(52, 152, 219, 0.1);
        color: #2980b9;
    }

    .status-text {
      font-size: 0.9rem;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .field-group {
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    input[type='text'],
    input[type='number'] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      font-size: 0.95rem;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s, background 0.2s;
      background: var(--input-bg);
      color: var(--text-main);
    }

    input[type='text']:focus,
    input[type='number']:focus {
      border-color: var(--primary);
      background: var(--card-bg);
      box-shadow: 0 0 0 2px rgba(26, 188, 156, 0.18);
    }
    
    .error-message {
      color: #e74c3c;
      font-size: 0.8rem;
      margin-top: 4px;
      display: none; /* Initially hidden */
    }


    /* Theme Toggle Button */
    .theme-toggle {
      background: none;
      border: none;
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: background 0.2s, transform 0.2s;
    }

    .theme-toggle:hover {
      background: rgba(26, 188, 156, 0.1);
      transform: scale(1.1);
    }

    .theme-toggle:active {
      transform: scale(0.95);
    }

    /* Offline Mode Indicator */
    .offline-bar {
      display: none;
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      padding: 8px 16px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    }

    .offline-bar.show {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .offline-bar .offline-icon {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .queue-badge {
      background: rgba(255, 255, 255, 0.25);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      margin-left: 4px;
    }

    .syncing-bar {
      display: none;
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      padding: 8px 16px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .syncing-bar.show {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .syncing-bar .spin {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    [data-theme="dark"] .offline-bar {
      background: linear-gradient(135deg, #c0392b, #962d22);
    }

    [data-theme="dark"] .syncing-bar {
      background: linear-gradient(135deg, #2980b9, #1f6391);
    }

    /* Quick Actions Floating Bar */
    .quick-actions {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      border-radius: 16px;
      padding: 12px 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
      z-index: 900;
      max-width: calc(100% - 32px);
      width: auto;
      min-width: 280px;
    }

    .quick-actions.show {
      display: block;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .quick-actions-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--timeline-border);
    }

    .quick-actions-title {
      font-size: 0.8rem;
      color: var(--text-sub);
      font-weight: 600;
    }

    .quick-actions-stop {
      font-size: 0.85rem;
      color: var(--text-main);
      font-weight: 700;
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .quick-actions-buttons {
      display: flex;
      gap: 10px;
    }

    .quick-actions-buttons button {
      flex: 1;
      padding: 10px 16px;
      font-size: 0.9rem;
      border-radius: 10px;
      min-width: 0;
    }

    .quick-actions-buttons .btn-checkin {
      background: linear-gradient(135deg, #27ae60, #219a52);
    }

    .quick-actions-buttons .btn-checkout {
      background: linear-gradient(135deg, #e67e22, #d35400);
    }

    .quick-actions-close {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--text-sub);
      color: white;
      border: none;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
    }

    .quick-actions-close:hover {
      background: #e74c3c;
    }

    [data-theme="dark"] .quick-actions {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    /* Notification Settings Button */
    .notification-btn {
      background: none;
      border: none;
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: background 0.2s, transform 0.2s;
      position: relative;
    }

    .notification-btn:hover {
      background: rgba(26, 188, 156, 0.1);
      transform: scale(1.1);
    }

    .notification-btn .notif-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 10px;
      height: 10px;
      background: #e74c3c;
      border-radius: 50%;
      border: 2px solid var(--card-bg);
    }

    /* In-App Toast Notification */
    .toast-container {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1100;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: calc(100% - 32px);
      width: 350px;
      pointer-events: none;
    }

    .toast {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      animation: toastIn 0.3s ease-out;
      pointer-events: auto;
      border-left: 4px solid var(--primary);
    }

    .toast.toast-warning {
      border-left-color: #f39c12;
    }

    .toast.toast-error {
      border-left-color: #e74c3c;
    }

    .toast.toast-out {
      animation: toastOut 0.3s ease-in forwards;
    }

    @keyframes toastIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes toastOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    .toast-icon {
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
      min-width: 0;
    }

    .toast-title {
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .toast-message {
      font-size: 0.8rem;
      color: var(--text-sub);
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-sub);
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
      line-height: 1;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .toast-close:hover {
      opacity: 1;
    }

    /* Notification Settings Modal Content */
    .notif-settings {
      text-align: left;
    }

    .notif-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--timeline-border);
    }

    .notif-option:last-child {
      border-bottom: none;
    }

    .notif-option-label {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notif-option-icon {
      font-size: 1.3rem;
    }

    .notif-option-text {
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .notif-option-desc {
      font-size: 0.75rem;
      color: var(--text-sub);
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 28px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.3s;
      border-radius: 28px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: var(--primary);
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(22px);
    }

    [data-theme="dark"] .toggle-slider {
      background-color: #444;
    }

    /* Trip Dashboard */
    .trip-dashboard {
      display: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: var(--border-radius);
      padding: 16px;
      margin-bottom: 16px;
      color: white;
    }

    .trip-dashboard.show {
      display: block;
    }

    .trip-dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .trip-dashboard-title {
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .trip-dashboard-ref {
      font-size: 0.8rem;
      opacity: 0.9;
      background: rgba(255,255,255,0.2);
      padding: 2px 8px;
      border-radius: 8px;
    }

    .trip-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 14px;
    }

    .trip-stat {
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 10px 12px;
      text-align: center;
    }

    .trip-stat-value {
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .trip-stat-label {
      font-size: 0.7rem;
      opacity: 0.85;
      margin-top: 2px;
    }

    .trip-progress {
      margin-bottom: 12px;
    }

    .trip-progress-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-bottom: 6px;
      opacity: 0.9;
    }

    .trip-progress-bar {
      height: 8px;
      background: rgba(255,255,255,0.25);
      border-radius: 4px;
      overflow: hidden;
    }

    .trip-progress-fill {
      height: 100%;
      background: white;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .trip-stops-mini {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .trip-stop-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      font-weight: 700;
      background: rgba(255,255,255,0.25);
      border: 2px solid transparent;
    }

    .trip-stop-dot.completed {
      background: white;
      color: var(--primary);
    }

    .trip-stop-dot.in-progress {
      background: rgba(255,255,255,0.4);
      border-color: white;
      animation: dotPulse 1.5s infinite;
    }

    @keyframes dotPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    .trip-stop-dot.pending {
      opacity: 0.6;
    }

    .trip-extra-info {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.2);
      font-size: 0.75rem;
    }

    .trip-extra-item {
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(255,255,255,0.15);
      padding: 4px 8px;
      border-radius: 6px;
    }

    button {
      width: 100%;
      padding: 11px 12px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        opacity 0.15s;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(22, 160, 133, 0.28);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
      opacity: 0.9;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn-small {
      width: auto;
      padding: 10px 16px;
      font-size: 0.95rem;
      border-radius: 999px;
      margin: 4px 6px 0 0;
    }

    .btn-outline {
      background: #ffffff;
      color: var(--primary-dark);
      border: 1px solid rgba(26, 188, 156, 0.35);
      box-shadow: none;
    }

    .btn-outline:hover {
      background: rgba(26, 188, 156, 0.06);
    }

    .btn-warning {
      background: #f39c12;
      background: linear-gradient(135deg, #f39c12, #d35400);
    }

    .btn-secondary {
      background: #95a5a6;
      background: linear-gradient(135deg, #95a5a6, #7f8c8d);
    }

    .summary-card {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f7faf9;
      border: 1px solid #e3ebe8;
      font-size: 0.88rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .summary-label {
      color: var(--text-sub);
    }

    .summary-value {
      font-weight: 600;
    }

    .timeline-container {
      margin-top: 14px;
    }

    .timeline-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .timeline {
      position: relative;
      margin: 0;
      padding: 4px 0 0 20px;
      list-style: none;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 9px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom,
          rgba(26, 188, 156, 0.6),
          rgba(26, 188, 156, 0.1));
    }

    .timeline-item {
      position: relative;
      margin-bottom: 14px;
    }

    .timeline-marker {
      position: absolute;
      left: -1px;
      top: 6px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ffffff;
      border: 2px solid var(--primary);
      box-shadow: 0 0 0 2px rgba(26, 188, 156, 0.15);
    }

    .timeline-content {
      margin-left: 14px;
      background: #ffffff;
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid #e4ece9;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.04);
    }

    .timeline-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .timeline-stop-label {
      font-size: 0.9rem;
      font-weight: 800;
      color: var(--primary-dark);
    }

    .timeline-status {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(22, 160, 133, 0.06);
      color: var(--primary-dark);
    }

    .timeline-sub {
      font-size: 0.82rem;
      color: var(--text-sub);
      margin-bottom: 2px;
    }

    .materials-text {
      font-size: 0.8rem;
      color: #444;
      margin-top: 4px;
    }

    .action-row {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: stretch;
    }

    .action-row button {
      flex: 1;
    }

    .btn-nav {
      flex: 0 0 25%;
      background: #0d6efd;
      color: #fff;
      border-radius: 8px;
      padding: 8px 6px;
      text-align: center;
      font-size: 0.8rem;
      border: none;
      width: auto;
    }

    .btn-nav:hover {
      opacity: 0.9;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--text-sub);
      text-align: center;
    }

    .last-updated {
      margin-top: 10px;
      padding: 8px 12px;
      background: rgba(26, 188, 156, 0.08);
      border-radius: 8px;
      font-size: 0.8rem;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .last-updated-text {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .auto-refresh-badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--primary);
      color: #fff;
    }

    .auto-refresh-badge.paused {
      background: #95a5a6;
    }

    /* Pull-to-Refresh Styles */
    .ptr-indicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%) translateY(-60px);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--card-bg);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .ptr-indicator.visible {
      opacity: 1;
    }

    .ptr-indicator.refreshing .ptr-spinner {
       display: block;
    }
    .ptr-indicator.refreshing .ptr-arrow {
       display: none;
    }

    .ptr-arrow {
      font-size: 1.2rem;
      transition: transform 0.2s ease;
      color: var(--primary);
      display: block;
    }
    
    .ptr-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(26, 188, 156, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: ptr-spin 0.8s linear infinite;
      display: none;
    }

    @keyframes ptr-spin {
      to { transform: rotate(360deg); }
    }

    /* GPS Status Indicator */
    .gps-status {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .gps-status.checking {
      background: rgba(52, 152, 219, 0.1);
      color: #3498db;
    }

    .gps-status.good {
      background: rgba(26, 188, 156, 0.1);
      color: var(--primary-dark);
    }

    .gps-status.weak {
      background: rgba(243, 156, 18, 0.1);
      color: #d68910;
    }

    .gps-status.error {
      background: rgba(231, 76, 60, 0.1);
      color: #c0392b;
    }

    .gps-icon {
      font-size: 1rem;
    }

    .gps-accuracy {
      margin-left: auto;
      font-size: 0.7rem;
      opacity: 0.8;
    }

    .gps-bars {
      display: flex;
      align-items: flex-end;
      gap: 2px;
      height: 14px;
    }

    .gps-bar {
      width: 4px;
      background: currentColor;
      border-radius: 1px;
      opacity: 0.3;
      transition: opacity 0.2s ease;
    }

    .gps-bar.active {
      opacity: 1;
    }

    .gps-bar:nth-child(1) { height: 4px; }
    .gps-bar:nth-child(2) { height: 7px; }
    .gps-bar:nth-child(3) { height: 10px; }
    .gps-bar:nth-child(4) { height: 14px; }

    @keyframes gps-pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .gps-status.checking .gps-bar {
      animation: gps-pulse 1s ease-in-out infinite;
    }

    .gps-status.checking .gps-bar:nth-child(2) { animation-delay: 0.1s; }
    .gps-status.checking .gps-bar:nth-child(3) { animation-delay: 0.2s; }
    .gps-status.checking .gps-bar:nth-child(4) { animation-delay: 0.3s; }

    .hidden {
      display: none !important;
    }

    .inline-flex {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      width: calc(100% - 24px);
      max-width: 520px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
      border-left: 4px solid var(--primary);
      padding: 10px 12px 11px;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
    }

    .inline-flex-bar {
      width: 42px;
      height: 4px;
      border-radius: 99px;
      background: rgba(26, 188, 156, 0.2);
      margin: 0 auto 6px;
    }

    .inline-flex-title {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 2px;
      text-align: left;
    }

    .inline-flex-text {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-bottom: 2px;
    }

    .inline-flex-sub {
      font-size: 0.76rem;
      color: #555;
    }

    .inline-flex.show {
      animation: dropIn 0.35s ease-out forwards;
      pointer-events: auto;
    }

    .inline-flex.hide {
      animation: fadeOutUp 0.25s ease-in forwards;
      pointer-events: none;
    }

    @keyframes dropIn {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @keyframes fadeOutUp {
      from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      to {
        opacity: 0;
        transform: translateX(-50%) translateY(-15px);
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 14px 14px 18px;
      }

      .title {
        font-size: 1.05rem;
      }

      button {
        font-size: 0.9rem;
      }
    }
  </style>
</head>

<body>
  <!-- Offline Mode Bar -->
  <div id="offlineBar" class="offline-bar">
    <span class="offline-icon">üìµ</span>
    <span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</span>
    <span id="queueBadge" class="queue-badge" style="display:none;">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏™‡πà‡∏á</span>
  </div>

  <!-- Syncing Bar -->
  <div id="syncingBar" class="syncing-bar">
    <span class="spin">üîÑ</span>
    <span id="syncingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
  </div>

  <!-- Toast Notification Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Quick Actions Floating Bar -->
  <div id="quickActions" class="quick-actions">
    <button class="quick-actions-close" id="quickActionsClose" title="‡∏õ‡∏¥‡∏î">‚úï</button>
    <div class="quick-actions-header">
      <span class="quick-actions-title">‚ö° ‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
      <span id="quickActionsStop" class="quick-actions-stop"></span>
    </div>
    <div id="quickActionsButtons" class="quick-actions-buttons">
      <!-- Buttons will be inserted here by app.js -->
    </div>
  </div>

  <!-- Inline Flex Notification -->
  <div id="inlineFlex" class="inline-flex hidden">
    <div class="inline-flex-bar"></div>
    <div class="inline-flex-title" id="inlineFlexTitle"></div>
    <div class="inline-flex-text" id="inlineFlexMain"></div>
    <div class="inline-flex-sub" id="inlineFlexSub"></div>
  </div>

  <div class="app-shell" id="appShell">
    <!-- Pull-to-Refresh Indicator -->
    <div id="ptrIndicator" class="ptr-indicator">
      <span id="ptrIcon" class="ptr-arrow">‚Üì</span>
      <div class="ptr-spinner"></div>
    </div>

    <div class="container">
      <div class="card">
        <div class="header">
          <div class="title">
            üöö Driver Tracking
            <span class="badge supabase">Supabase</span>
            <span class="realtime-dot" title="Realtime Connected"></span>
          </div>
          <div style="display:flex;gap:4px;">
            <button id="notificationBtn" class="notification-btn" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
              üîî
              <span class="notif-badge hidden"></span>
            </button>
            <button id="themeToggle" class="theme-toggle" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô">
              üåô
            </button>
          </div>
        </div>

        <div id="status" class="status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å LINE...</div>

        <!-- GPS Status Indicator -->
        <div id="gpsStatus" class="gps-status checking" style="cursor:pointer;" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS ‡πÉ‡∏´‡∏°‡πà">
          <span class="gps-icon">üìç</span>
          <span id="gpsText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS...</span>
          <div class="gps-bars">
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
          </div>
          <span id="gpsAccuracy" class="gps-accuracy"></span>
        </div>

        <div class="field-group">
          <label for="keyword">‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏á‡∏≤‡∏ô (Reference No.)</label>
          <input id="keyword" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Reference ‡πÄ‡∏ä‡πà‡∏ô 2511S15403" maxlength="50" />
          <div id="keywordError" class="error-message"></div>
        </div>

        <button id="btnSearch">
          <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô</span>
        </button>

        <div id="summary" class="summary-card hidden"></div>

        <div id="alcoholContainer" class="summary-card hidden" style="margin-top:10px;"></div>

        <!-- Trip Dashboard -->
        <div id="tripDashboard" class="trip-dashboard hidden">
          <div class="trip-dashboard-header">
            <div class="trip-dashboard-title">
              üìä ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß
            </div>
            <div id="tripRef" class="trip-dashboard-ref"></div>
          </div>

          <div class="trip-stats">
            <div class="trip-stat">
              <div id="tripCompleted" class="trip-stat-value">0/0</div>
              <div class="trip-stat-label">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
            </div>
            <div class="trip-stat">
              <div id="tripDuration" class="trip-stat-value">-</div>
              <div class="trip-stat-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
            </div>
          </div>

          <div class="trip-progress">
            <div class="trip-progress-header">
              <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
              <span id="tripProgressPercent">0%</span>
            </div>
            <div class="trip-progress-bar">
              <div id="tripProgressFill" class="trip-progress-fill" style="width:0%"></div>
            </div>
          </div>

          <div id="tripStopsMini" class="trip-stops-mini">
            <!-- Mini stop dots will be rendered here -->
          </div>
        </div>

        <div id="timelineContainer" class="timeline-container hidden">
          <div class="timeline-title">
            ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            <span style="font-size:0.8rem;color:var(--text-sub);">(‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á)</span>
          </div>
          <ul id="timeline" class="timeline"></ul>

          <div id="closeJobContainer" class="hidden" style="margin-top:8px;">
            <button id="btnCloseJob" class="btn-secondary" style="width:100%;margin-bottom:6px;">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô (‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)</button>
            <button id="btnEndTrip" class="btn-secondary" style="width:100%;display:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå + ‡∏à‡∏∏‡∏î‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ)</button>
          </div>
        </div>

        <div id="lastUpdatedContainer" class="last-updated hidden">
          <div class="last-updated-text">
            <span>üîÑ</span>
            <span id="lastUpdatedText">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</span>
          </div>
          <span id="autoRefreshBadge" class="auto-refresh-badge">Realtime</span>
        </div>

        <div class="footer-note">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Check-in / Check-out ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏à‡∏≠<br>
          <small style="color:#3ecf8e;">Powered by Supabase - Modular Version</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced UX Features -->
  <script src="js/enhanced-ux.js"></script>
  
  <!-- Application Script (ES Module) -->
  <script type="module" src="js/app.js?v=20260117125000"></script>
</body>

</html>
