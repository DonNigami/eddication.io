<!DOCTYPE html>
<html lang="th">

<head>
  <base target="_top" />
  <meta charset="UTF-8" />
  <title>Driver Tracking (Supabase - Modular)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
  <!-- Offline Mode Bar -->
  <div id="offlineBar" class="offline-bar">
    <span>üìµ</span>
    <span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</span>
    <span id="queueBadge" class="queue-badge" style="display:none;">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏™‡πà‡∏á</span>
  </div>

  <!-- Pull-to-Refresh Indicator -->
  <div id="ptrIndicator" class="ptr-indicator">
    <div style="text-align:center;">
      <div id="ptrIcon" style="font-size:1.8rem;transition:transform 0.3s;">‚Üì</div>
      <div id="ptrText" style="font-size:0.85rem;color:var(--text-sub);margin-top:4px;">‡∏î‡∏∂‡∏á‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</div>
    </div>
  </div>

  <!-- Syncing Bar -->
  <div id="syncingBar" class="syncing-bar">
    <span class="spin">‚öôÔ∏è</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Inline Flex Notification -->
  <div id="inlineFlex" class="inline-flex hidden">
    <div class="inline-flex-bar"></div>
    <div class="inline-flex-title" id="inlineFlexTitle"></div>
    <div class="inline-flex-text" id="inlineFlexMain"></div>
    <div class="inline-flex-sub" id="inlineFlexSub"></div>
  </div>

  <div class="app-shell" id="appShell">
    <div class="container">
      <div class="card">
        <div class="header">
          <div class="title">
            üöö Driver Tracking
            <span class="badge supabase">Supabase</span>
            <span class="realtime-dot" title="Realtime Connected"></span>
          </div>
          <div style="display:flex;gap:4px;">
            <button id="notificationBtn" class="notification-btn" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
              üîî
              <span class="notif-badge hidden"></span>
            </button>
            <button id="themeToggle" class="theme-toggle" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô">üåô</button>
          </div>
        </div>

        <div id="status" class="status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å LINE...</div>

        <!-- GPS Status Indicator -->
        <div id="gpsStatus" class="gps-status checking" style="cursor:pointer;" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS ‡πÉ‡∏´‡∏°‡πà">
          <span class="gps-icon">üìç</span>
          <span id="gpsText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS...</span>
          <div class="gps-bars">
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
          </div>
          <span id="gpsAccuracy" class="gps-accuracy"></span>
        </div>

        <div class="field-group">
          <label for="keyword">‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏á‡∏≤‡∏ô (Reference No.)</label>
          <input id="keyword" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Reference ‡πÄ‡∏ä‡πà‡∏ô 2511S15403" maxlength="50" />
          <div id="keywordError" class="error-message"></div>
        </div>

        <button id="btnSearch">
          <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô</span>
        </button>

        <div id="summary" class="summary-card hidden"></div>
        <div id="summarySkeleton" class="summary-card skeleton-summary hidden">
          <div class="skeleton-row"><div class="skeleton skeleton-label"></div><div class="skeleton skeleton-value"></div></div>
          <div class="skeleton-row"><div class="skeleton skeleton-label"></div><div class="skeleton skeleton-value"></div></div>
          <div class="skeleton-row"><div class="skeleton skeleton-label"></div><div class="skeleton skeleton-value"></div></div>
          <div class="skeleton-row" style="margin-bottom:0;"><div class="skeleton skeleton-label"></div><div class="skeleton skeleton-value"></div></div>
        </div>
        <div id="alcoholContainer" class="summary-card hidden" style="margin-top:10px;"></div>

        <div id="timelineSkeleton" class="timeline-container hidden">
          <div class="timeline-title">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
          <div style="padding-left:20px;">
            <div class="skeleton-timeline-item"><div class="skeleton skeleton-marker"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-sub"></div><div class="skeleton-buttons"><div class="skeleton skeleton-btn"></div><div class="skeleton skeleton-btn"></div></div></div></div>
            <div class="skeleton-timeline-item"><div class="skeleton skeleton-marker"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-sub"></div><div class="skeleton-buttons"><div class="skeleton skeleton-btn"></div><div class="skeleton skeleton-btn"></div></div></div></div>
            <div class="skeleton-timeline-item"><div class="skeleton skeleton-marker"></div><div class="skeleton-content"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-sub"></div><div class="skeleton-buttons"><div class="skeleton skeleton-btn"></div><div class="skeleton skeleton-btn"></div></div></div></div>
          </div>
        </div>

        <div id="timelineContainer" class="timeline-container hidden">
          <div class="timeline-title">
            ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            <span style="font-size:0.8rem;color:var(--text-sub);">(‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á)</span>
          </div>
          <ul id="timeline" class="timeline"></ul>

          <div id="closeJobContainer" class="hidden" style="margin-top:8px;">
            <button id="btnCloseJob" class="btn-secondary" style="width:100%;margin-bottom:6px;">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô (‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)</button>
            <button id="btnEndTrip" class="btn-secondary" style="width:100%;display:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå + ‡∏à‡∏∏‡∏î‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ)</button>
          </div>
        </div>

        <div id="lastUpdatedContainer" class="last-updated hidden">
          <div style="display:flex;align-items:center;gap:6px;">
            <span>üîÑ</span>
            <span id="lastUpdatedText">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</span>
          </div>
          <span id="autoRefreshBadge" class="auto-refresh-badge">Realtime</span>
        </div>

        <div class="footer-note">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Check-in / Check-out ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏à‡∏≠<br>
          <small style="color:#3ecf8e;">Powered by Supabase - Modular Version</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Floating Bar -->
  <div id="quickActions" class="quick-actions hidden">
    <div class="quick-actions-header">
      <span class="quick-actions-title">‚ö° ‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
      <span id="quickActionsStop" class="quick-actions-stop"></span>
      <button class="quick-actions-close" id="quickActionsClose">‚úï</button>
    </div>
    <div id="quickActionsButtons" class="quick-actions-buttons"></div>
  </div>

  <!-- Enhanced UX Features -->
  <script src="js/enhanced-ux.js"></script>
  
  <!-- Application Script (ES Module) -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
