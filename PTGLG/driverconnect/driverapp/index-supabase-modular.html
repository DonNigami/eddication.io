<!DOCTYPE html>
<html lang="th">

<head>
  <base target="_top" />
  <meta charset="UTF-8" />
  <title>Driver Tracking (Supabase - Modular)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Driver Tracking Application - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏™‡πà‡∏á">
  <meta name="theme-color" content="#1abc9c">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- External Stylesheet -->
  <link rel="stylesheet" href="css/styles.css">

  <!-- LIFF SDK - Must load first (no defer) -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
</head>

<body>
  <!-- Offline Mode Bar -->
  <div id="offlineBar" class="offline-bar" role="alert" aria-live="assertive">
    <span class="offline-icon" aria-hidden="true">üìµ</span>
    <span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</span>
    <span id="queueBadge" class="queue-badge" style="display:none;">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏™‡πà‡∏á</span>
  </div>

  <!-- Syncing Bar -->
  <div id="syncingBar" class="syncing-bar" role="status" aria-live="polite">
    <span class="spin" aria-hidden="true">üîÑ</span>
    <span id="syncingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
  </div>

  <!-- Toast Notification Container -->
  <div id="toastContainer" class="toast-container" role="region" aria-live="polite" aria-label="‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"></div>

  <!-- Quick Actions Floating Bar -->
  <div id="quickActions" class="quick-actions" role="region" aria-label="‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô">
    <button class="quick-actions-close" id="quickActionsClose" aria-label="‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô">‚úï</button>
    <div class="quick-actions-header">
      <span class="quick-actions-title">‚ö° ‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
      <span id="quickActionsStop" class="quick-actions-stop"></span>
    </div>
    <div id="quickActionsButtons" class="quick-actions-buttons">
      <!-- Buttons will be inserted here by app.js -->
    </div>
  </div>

  <!-- Inline Flex Notification -->
  <div id="inlineFlex" class="inline-flex hidden" role="alert" aria-live="polite">
    <div class="inline-flex-bar" aria-hidden="true"></div>
    <div class="inline-flex-title" id="inlineFlexTitle"></div>
    <div class="inline-flex-text" id="inlineFlexMain"></div>
    <div class="inline-flex-sub" id="inlineFlexSub"></div>
  </div>

  <div class="app-shell" id="appShell">
    <!-- Pull-to-Refresh Indicator -->
    <div id="ptrIndicator" class="ptr-indicator" aria-hidden="true">
      <span id="ptrIcon" class="ptr-arrow">‚Üì</span>
      <span id="ptrText" class="ptr-text"></span>
      <div class="ptr-spinner"></div>
    </div>

    <div class="container">
      <div class="card">
        <div class="header">
          <div class="title">
            <span aria-hidden="true">üöö</span> Driver Tracking
            <span class="badge supabase">Supabase</span>
            <span class="realtime-dot" title="Realtime Connected" aria-label="‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Realtime"></span>
          </div>
          <div style="display:flex;gap:4px;">
            <button id="notificationBtn" class="notification-btn" aria-label="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
              <span aria-hidden="true">üîî</span>
              <span class="notif-badge hidden" aria-hidden="true"></span>
            </button>
            <button id="themeToggle" class="theme-toggle" aria-label="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô">
              <span aria-hidden="true">üåô</span>
            </button>
          </div>
        </div>

        <div id="status" class="status-text" role="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å LINE...</div>

        <!-- GPS Status Indicator -->
        <div id="gpsStatus" class="gps-status checking" style="cursor:pointer;" role="status" aria-live="polite" aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ GPS">
          <span class="gps-icon" aria-hidden="true">üìç</span>
          <span id="gpsText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS...</span>
          <div class="gps-bars" aria-hidden="true">
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
            <div class="gps-bar"></div>
          </div>
          <span id="gpsAccuracy" class="gps-accuracy"></span>
        </div>

        <div class="field-group">
          <label for="keyword">‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏á‡∏≤‡∏ô (Reference No.)</label>
          <input id="keyword" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Reference ‡πÄ‡∏ä‡πà‡∏ô 2511S15403" maxlength="50" autocomplete="off" />
          <div id="keywordError" class="error-message" role="alert"></div>
        </div>

        <button id="btnSearch">
          <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô</span>
        </button>

        <!-- Force Refresh Button (shown when job is loaded) -->
        <button id="btnForceRefresh" class="btn-refresh hidden" style="width:100%;margin-top:8px;">
          <span>üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
        </button>

        <div id="summary" class="summary-card hidden"></div>

        <div id="alcoholContainer" class="summary-card hidden" style="margin-top:10px;"></div>

        <!-- Trip Dashboard -->
        <div id="tripDashboard" class="trip-dashboard hidden" role="region" aria-label="‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß">
          <div class="trip-dashboard-header">
            <div class="trip-dashboard-title">
              <span aria-hidden="true">üìä</span> ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß
            </div>
            <div id="tripRef" class="trip-dashboard-ref"></div>
          </div>

          <div class="trip-stats">
            <div class="trip-stat">
              <div id="tripCompleted" class="trip-stat-value">0/0</div>
              <div class="trip-stat-label">‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
            </div>
            <div class="trip-stat">
              <div id="tripDuration" class="trip-stat-value">-</div>
              <div class="trip-stat-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
            </div>
          </div>

          <div class="trip-progress">
            <div class="trip-progress-header">
              <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
              <span id="tripProgressPercent">0%</span>
            </div>
            <div class="trip-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <div id="tripProgressFill" class="trip-progress-fill" style="width:0%"></div>
            </div>
          </div>

          <div id="tripStopsMini" class="trip-stops-mini" aria-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á">
            <!-- Mini stop dots will be rendered here -->
          </div>
        </div>

        <div id="timelineContainer" class="timeline-container hidden">
          <div class="timeline-title">
            ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            <span style="font-size:0.8rem;color:var(--text-sub);">(‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á)</span>
          </div>
          <ul id="timeline" class="timeline" role="list" aria-label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á"></ul>

          <div id="closeJobContainer" class="hidden" style="margin-top:8px;">
            <button id="btnCloseJob" class="btn-secondary" style="width:100%;margin-bottom:6px;">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô (‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)</button>
            <button id="btnEndTrip" class="btn-secondary" style="width:100%;display:none;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ (‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå + ‡∏à‡∏∏‡∏î‡∏à‡∏ö‡∏ó‡∏£‡∏¥‡∏õ)</button>
          </div>
        </div>

        <div id="lastUpdatedContainer" class="last-updated hidden">
          <div class="last-updated-text">
            <span aria-hidden="true">üîÑ</span>
            <span id="lastUpdatedText">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</span>
          </div>
          <span id="autoRefreshBadge" class="auto-refresh-badge">Realtime</span>
        </div>

        <div class="footer-note">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Check-in / Check-out ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏à‡∏≠<br>
          <small style="color:#3ecf8e;">Powered by Supabase - Modular Version</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced UX Features -->
  <script src="js/enhanced-ux.js" defer></script>

  <!-- Application Script (ES Module) -->
  <script type="module" src="js/app.js?v=20260117125000"></script>
</body>

</html>
