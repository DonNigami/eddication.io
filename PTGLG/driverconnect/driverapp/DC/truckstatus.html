<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>DC Log ‚Äì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà DC & ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --bg: #f3f4f6;
      --bg-card: #ffffff;
      --border-subtle: #d1d5db;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.08);
      --accent-strong: #1d4ed8;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #b91c1c;
      --radius-lg: 18px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 520px;
      padding: 16px 12px 24px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 18px 16px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
    }

    .card-header-main {
      margin-bottom: 12px;
    }

    h1 {
      font-size: 20px;
      margin: 4px 0 4px;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      border: 1px solid rgba(37, 99, 235, 0.4);
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin: 0;
      line-height: 1.4;
    }

    /* Tabs */
    .tabs {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      margin: 14px 0 12px;
    }

    .tab-btn {
      flex: 1 1 0;
      border-radius: 999px;
      padding: 8px 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.12s ease, color 0.12s ease, box-shadow 0.12s ease, transform 0.12s ease;
      white-space: nowrap;
    }

    .tab-btn span.icon {
      font-size: 16px;
    }

    .tab-btn.active {
      background: #ffffff;
      color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
      transform: translateY(-1px);
    }

    .panel {
      margin-top: 4px;
    }

    .hidden {
      display: none !important;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin: 18px 0 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--text-main);
    }

    .section-title span.hint {
      font-size: 12px;
      font-weight: 400;
      color: var(--text-muted);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 480px) {
      .grid-2.inline-desktop {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    .field {
      margin-bottom: 12px;
    }

    .field-inline {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    input[type="text"],
    input[type="date"],
    input[type="file"],
    input[type="time"],
    textarea,
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      color: var(--text-main);
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
      background: #ffffff;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, opacity 0.12s ease;
      white-space: nowrap;
    }

    .btn-xs {
      padding: 8px 12px;
      font-size: 13px;
    }

    .btn-accent {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #ffffff;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
    }

    .btn-ghost {
      background: #e5e7eb;
      color: var(--text-main);
      border: 1px solid #d1d5db;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #ffffff;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
      margin-top: 14px;
    }

    .note {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    .note strong { color: #b45309; }

    .image-preview {
      margin-top: 8px;
      border-radius: 12px;
      border: 1px dashed #cbd5f5;
      padding: 8px;
      display: none;
      background: #eff6ff;
    }

    .image-preview img {
      max-width: 100%;
      border-radius: 10px;
      display: block;
    }

    .image-preview span {
      font-size: 12px;
      color: var(--text-muted);
      display: block;
      margin-bottom: 4px;
    }

    .footer-hint {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .required { color: var(--danger); margin-left: 2px; }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #facc15;
    }

    .table-wrapper {
      margin-top: 8px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      background: #f9fafb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
      font-size: 13px;
    }

    thead {
      background: #e5e7eb;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    th {
      font-weight: 600;
      color: #111827;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tbody tr:nth-child(even) { background: #f9fafb; }
    tbody tr:nth-child(odd)  { background: #ffffff; }

    tbody tr:hover {
      background: #dbeafe;
    }

    .no-data {
      padding: 12px;
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
    }

    .link {
      color: var(--accent-strong);
      text-decoration: underline;
      font-size: 12px;
    }

    .footer-hint-small {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .count-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .scroll-container {
      max-height: 380px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="card-header-main">
        <span class="badge">DC Log</span>
        <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà DC & ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h1>
        <p class="subtitle">
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà DC ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        </p>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="form">
          <span class="icon">üìù</span>
          <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å DC ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
        </button>
        <button class="tab-btn" data-tab="history">
          <span class="icon">üìÇ</span>
          <span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</span>
        </button>
      </div>

      <!-- Panel: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å DC -->
      <div class="panel" data-panel="form">
        <form id="dcForm">
          <div class="grid-2">
            <div class="field">
              <label for="reference">
                ‡πÄ‡∏•‡∏Ç Booking (9 ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ -)<span class="required">*</span>
              </label>
              <input
                type="text"
                id="reference"
                name="reference"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô 251243448 (‡∏à‡∏≤‡∏Å B001-251243448)"
                inputmode="numeric"
                maxlength="9"
                required
                oninput="enforceBookingDigits(this)"
              />
              <div class="note">
                ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ <strong>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å B001-</strong>
              </div>
            </div>
            <div class="field">
              <label for="truckPlate">
                ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ<span class="required">*</span>
              </label>
              <input
                type="text"
                id="truckPlate"
                name="truckPlate"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏ó-1234 / 70-xxxx"
                required
              />
            </div>
          </div>

          <div class="section-title">
            <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà DC</span>
            <span class="hint">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î ‚Äú‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
          </div>

          <div class="field">
            <label for="arriveDcTime">‡∏ñ‡∏∂‡∏á DC <span class="required">*</span></label>
            <div class="field-inline">
              <input
                type="time"
                id="arriveDcTime"
                name="arriveDcTime"
                required
              />
              <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('arriveDcTime')">
                ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
              </button>
            </div>
          </div>

          <div class="grid-2 inline-desktop">
            <div class="field">
              <label for="loadStartTime">‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏£‡∏¥‡πà‡∏°)</label>
              <div class="field-inline">
                <input
                  type="time"
                  id="loadStartTime"
                  name="loadStartTime"
                />
                <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('loadStartTime')">
                  ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
              </div>
            </div>
            <div class="field">
              <label for="loadEndTime">‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏™‡∏£‡πá‡∏à)</label>
              <div class="field-inline">
                <input
                  type="time"
                  id="loadEndTime"
                  name="loadEndTime"
                />
                <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('loadEndTime')">
                  ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
              </div>
            </div>
          </div>

          <div class="grid-2 inline-desktop">
            <div class="field">
              <label for="docStartTime">‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏£‡∏¥‡πà‡∏°)</label>
              <div class="field-inline">
                <input
                  type="time"
                  id="docStartTime"
                  name="docStartTime"
                />
                <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('docStartTime')">
                  ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
              </div>
            </div>
            <div class="field">
              <label for="docEndTime">‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏™‡∏£‡πá‡∏à)</label>
              <div class="field-inline">
                <input
                  type="time"
                  id="docEndTime"
                  name="docEndTime"
                />
                <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('docEndTime')">
                  ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                </button>
              </div>
            </div>
          </div>

          <div class="field">
            <label for="departTime">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DC</label>
            <div class="field-inline">
              <input
                type="time"
                id="departTime"
                name="departTime"
              />
              <button type="button" class="btn btn-xs btn-ghost" onclick="setNow('departTime')">
                ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
              </button>
            </div>
          </div>

          <div class="field">
            <label for="remark">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
            <textarea
              id="remark"
              name="remark"
              placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏≤‡∏ô / ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô ‡∏Ø‡∏•‡∏Ø"
            ></textarea>
          </div>

          <div class="section-title">
            <span>‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ</span>
            <span class="tag">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏ô‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
          </div>

          <div class="field">
            <label for="photoRear">
              ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ <span class="required">*</span>
            </label>
            <input
              type="file"
              id="photoRear"
              name="photoRear"
              accept="image/*"
              capture="environment"
              required
            />
            <div class="note">
              ‚Ä¢ ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á <strong>‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏•‡∏±‡∏á + ‡∏ã‡∏µ‡∏•/‡∏Å‡∏∏‡∏ç‡πÅ‡∏à</strong><br />
              ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </div>

            <div id="previewBox" class="image-preview">
              <span>‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</span>
              <img id="previewImage" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ" />
            </div>
          </div>

          <button type="submit" class="btn btn-accent btn-full">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô DC
          </button>

          <div class="footer-hint">
            <div>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö <code>HH:mm ‡∏ô.</code></div>
            <div>‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏π‡∏õ) ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5‚Äì10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
          </div>
        </form>
      </div>

      <!-- Panel: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á -->
      <div class="panel hidden" data-panel="history">
        <div class="field" style="margin-top:6px;">
          <div class="grid-2 inline-desktop" style="grid-template-columns: 2fr 1.5fr 1.5fr auto;">
            <div>
              <label for="truckPlateHistory">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)</label>
              <input
                type="text"
                id="truckPlateHistory"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô 9508 / 70-xxxx / ‡∏Å‡∏ó63"
              />
            </div>
            <div>
              <label for="dateFrom">‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" id="dateFrom" />
            </div>
            <div>
              <label for="dateTo">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" id="dateTo" />
            </div>
            <div style="display:flex; gap:6px; align-items:flex-end;">
              <div style="flex:1;">
                <label for="limitSelect">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                <select id="limitSelect">
                  <option value="20">20</option>
                  <option value="50" selected>50</option>
                  <option value="100">100</option>
                </select>
              </div>
              <button id="btnSearch" class="btn btn-primary" style="margin-bottom:0;">
                ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>
            </div>
          </div>
        </div>

        <div class="table-wrapper">
          <div class="scroll-container">
            <table>
              <thead>
                <tr>
                  <th style="min-width:120px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                  <th style="min-width:80px;">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</th>
                  <th style="min-width:80px;">Booking</th>
                  <th style="min-width:90px;">‡∏ñ‡∏∂‡∏á DC</th>
                  <th style="min-width:110px;">‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th style="min-width:110px;">‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
                  <th style="min-width:80px;">‡∏≠‡∏≠‡∏Å DC</th>
                  <th style="min-width:140px;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                  <th style="min-width:80px;">‡∏£‡∏π‡∏õ</th>
                </tr>
              </thead>
              <tbody id="logBody">
                <tr><td colspan="9" class="no-data">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="footer-hint-small">
          <span id="countLabel" class="count-label">‡πÅ‡∏™‡∏î‡∏á 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
          <span>Tip: ‡πÉ‡∏™‡πà‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô + ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // üëá ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Web App ‡∏Ç‡∏≠‡∏á Apps Script
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQDbS5JZyzkbYxfdDLz8q2XCvBbRqQ9fE36Mn_dgvdabzzDcl4R5oV0tliQo_rLfv8RA/exec";

    /* --------- Tabs --------- */
    const tabButtons = document.querySelectorAll(".tab-btn");
    const panels = document.querySelectorAll(".panel");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.getAttribute("data-tab");
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        panels.forEach((p) => {
          if (p.getAttribute("data-panel") === tab) {
            p.classList.remove("hidden");
          } else {
            p.classList.add("hidden");
          }
        });

        if (tab === "history" && !window.__historyInitialized) {
          window.__historyInitialized = true;
          fetchLogs();
        }
      });
    });

    /* --------- Time helper --------- */
    function setNow(fieldId) {
      const el = document.getElementById(fieldId);
      if (!el) return;
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      el.value = `${hh}:${mm}`;
    }
    window.setNow = setNow;

    /* --------- Booking helper: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å --------- */
    function enforceBookingDigits(el) {
      el.value = el.value.replace(/\D/g, "").slice(0, 9);
    }
    window.enforceBookingDigits = enforceBookingDigits;

    /* --------- Preview ‡∏£‡∏π‡∏õ --------- */
    const photoInput = document.getElementById("photoRear");
    const previewBox = document.getElementById("previewBox");
    const previewImage = document.getElementById("previewImage");

    photoInput.addEventListener("change", function () {
      const file = this.files && this.files[0];
      if (!file) {
        previewBox.style.display = "none";
        previewImage.src = "";
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        previewImage.src = e.target.result;
        previewBox.style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    /* --------- Resize ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î --------- */
    function resizeImage(file, maxSize = 1280) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = (e) => {
          img.onload = () => {
            let { width, height } = img;
            if (width <= maxSize && height <= maxSize) {
              return resolve(e.target.result); // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡πà‡∏≠
            }
            const canvas = document.createElement("canvas");
            if (width > height) {
              canvas.width = maxSize;
              canvas.height = (height * maxSize) / width;
            } else {
              canvas.height = maxSize;
              canvas.width = (width * maxSize) / height;
            }
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            const dataUrl = canvas.toDataURL("image/jpeg", 0.7); // ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 70%
            resolve(dataUrl);
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function formatTimeForPayload(value) {
      if (!value) return "";
      return `${value} ‡∏ô.`; // backend ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô HH:MM ‡∏ô.
    }

    /* --------- Form Submit --------- */
    const form = document.getElementById("dcForm");
    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const referenceRaw = document.getElementById("reference").value.trim();
      const truckPlate   = document.getElementById("truckPlate").value.trim();

      const arriveRaw    = document.getElementById("arriveDcTime").value.trim();
      const loadStartRaw = document.getElementById("loadStartTime").value.trim();
      const loadEndRaw   = document.getElementById("loadEndTime").value.trim();
      const docStartRaw  = document.getElementById("docStartTime").value.trim();
      const docEndRaw    = document.getElementById("docEndTime").value.trim();
      const departRaw    = document.getElementById("departTime").value.trim();

      const remark       = document.getElementById("remark").value.trim();
      const file         = photoInput.files && photoInput.files[0];

      const numericRef = referenceRaw.replace(/\D/g, "");
      if (!numericRef || numericRef.length !== 9) {
        Swal.fire(
          "‡πÄ‡∏•‡∏Ç Booking ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
          "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Booking ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ - ‡πÄ‡∏ä‡πà‡∏ô 251243448",
          "warning"
        );
        return;
      }

      if (!truckPlate) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ", "", "warning");
        return;
      }
      if (!arriveRaw) {
        Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ "‡∏ñ‡∏∂‡∏á DC"', "", "warning");
        return;
      }
      if (!file) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ", "", "warning");
        return;
      }

      try {
        Swal.fire({
          title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
          html: "‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5‚Äì10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        let imageBase64;
        try {
          imageBase64 = await resizeImage(file);
        } catch (err) {
          console.warn("Resize ‡∏£‡∏π‡∏õ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏ó‡∏ô", err);
          imageBase64 = await new Promise((resolve, reject) => {
            const r = new FileReader();
            r.onload = (e) => resolve(e.target.result);
            r.onerror = reject;
            r.readAsDataURL(file);
          });
        }

        const payload = {
          action: "saveDcLog",
          reference: numericRef,
          truckPlate: truckPlate,
          arriveDcTime: formatTimeForPayload(arriveRaw),
          loadStartTime: formatTimeForPayload(loadStartRaw),
          loadEndTime: formatTimeForPayload(loadEndRaw),
          docStartTime: formatTimeForPayload(docStartRaw),
          docEndTime: formatTimeForPayload(docEndRaw),
          departTime: formatTimeForPayload(departRaw),
          remark: remark,
          imageBase64: imageBase64,
        };

        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
          body: JSON.stringify(payload),
        });

        const result = await res.json().catch(() => ({}));
        Swal.close();

        if (result && result.success) {
          Swal.fire({
            icon: "success",
            title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            text: result.message || "‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô DC ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
          });
          form.reset();
          previewBox.style.display = "none";
          previewImage.src = "";
        } else {
          Swal.fire({
            icon: "error",
            title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            text:
              (result && result.message) ||
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
          });
        }
      } catch (err) {
        console.error(err);
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô",
        });
      }
    });

    /* --------- History --------- */
    const truckPlateHistoryInput = document.getElementById("truckPlateHistory");
    const dateFromInput   = document.getElementById("dateFrom");
    const dateToInput     = document.getElementById("dateTo");
    const limitSelect     = document.getElementById("limitSelect");
    const btnSearch       = document.getElementById("btnSearch");
    const logBody         = document.getElementById("logBody");
    const countLabel      = document.getElementById("countLabel");

    btnSearch.addEventListener("click", () => {
      fetchLogs();
    });

    async function fetchLogs() {
      const truckPlate = truckPlateHistoryInput.value.trim();
      const dateFrom   = dateFromInput.value;
      const dateTo     = dateToInput.value;
      const limit      = limitSelect.value;

      try {
        Swal.fire({
          title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
          html: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        const params = new URLSearchParams();
        params.set("action", "getDcLogs");
        if (truckPlate) params.set("truckPlate", truckPlate);
        if (dateFrom)   params.set("dateFrom", dateFrom);
        if (dateTo)     params.set("dateTo", dateTo);
        params.set("limit", limit);

        const res = await fetch(`${SCRIPT_URL}?${params.toString()}`, {
          method: "GET",
        });

        const result = await res.json().catch(() => ({}));
        Swal.close();

        if (!result || !result.success) {
          Swal.fire({
            icon: "error",
            title: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ",
            text:
              (result && result.message) ||
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
          });
          return;
        }

        renderLogs(result.data || []);
      } catch (err) {
        console.error(err);
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
        });
      }
    }

    function renderLogs(logs) {
      logBody.innerHTML = "";

      if (!logs.length) {
        logBody.innerHTML =
          '<tr><td colspan="9" class="no-data">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>';
        countLabel.textContent = "‡πÅ‡∏™‡∏î‡∏á 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
        return;
      }

      logs.forEach((log) => {
        const tr = document.createElement("tr");

        const loadRange =
          (log.loadStart || "") && (log.loadEnd || "")
            ? `${log.loadStart} - ${log.loadEnd}`
            : (log.loadStart || log.loadEnd || "-");

        const docRange =
          (log.docStart || "") && (log.docEnd || "")
            ? `${log.docStart} - ${log.docEnd}`
            : (log.docStart || log.docEnd || "-");

        tr.innerHTML = `
          <td>${log.dateDisplay || log.timestamp || "-"}</td>
          <td>${log.truckPlate || "-"}</td>
          <td>${log.reference || "-"}</td>
          <td>${log.arriveDc || "-"}</td>
          <td>${loadRange || "-"}</td>
          <td>${docRange || "-"}</td>
          <td>${log.departDc || "-"}</td>
          <td>${escapeHtml(log.remark || "-")}</td>
          <td>
            ${
              log.imageUrl
                ? `<a href="${log.imageUrl}" class="link" target="_blank">‡∏î‡∏π‡∏£‡∏π‡∏õ</a>`
                : "-"
            }
          </td>
        `;
        logBody.appendChild(tr);
      });

      countLabel.textContent = `‡πÅ‡∏™‡∏î‡∏á ${logs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</body>
</html>
