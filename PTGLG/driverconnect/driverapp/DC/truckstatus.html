<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>DC Log ‚Äì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* ... (CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤ ‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏≠‡∏Å) ... */
    /* ‡∏ï‡∏±‡∏î‡∏ó‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ô‡∏µ‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ CSS ‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢ */
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="card-header-main">
        <div>
          <span class="badge">DC Log</span>
          <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà DC & ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h1>
          <p class="subtitle">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà DC ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
          </p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="form">
          <span class="icon">üìù</span>
          <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å DC ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
        </button>
        <button class="tab-btn" data-tab="history">
          <span class="icon">üìÇ</span>
          <span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</span>
        </button>
      </div>

      <!-- Panel: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å DC -->
      <div class="panel" data-panel="form">
        <form id="dcForm">
          <div class="grid-2">
            <div class="field">
              <label for="reference">
                ‡πÄ‡∏•‡∏Ç Booking (9 ‡∏´‡∏•‡∏±‡∏Å)<span class="required">*</span>
              </label>
              <input
                type="text"
                id="reference"
                name="reference"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô 251243448 (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å)"
                maxlength="9"
                inputmode="numeric"
                required
              />
              <div class="note">
                ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: <strong>YYMMXXXXX</strong> ‡πÄ‡∏ä‡πà‡∏ô <code>251243448</code><br>
                ‚Ä¢ 25 = ‡∏õ‡∏µ 2025, 12 = ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 12, 43448 = ‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
              </div>
            </div>
            <div class="field">
              <label for="truckPlate">
                ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ<span class="required">*</span>
              </label>
              <input
                type="text"
                id="truckPlate"
                name="truckPlate"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏ó-1234 / 70-xxxx"
                required
              />
            </div>
          </div>

          <!-- (‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÜ + ‡∏£‡∏π‡∏õ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á) -->
          <!-- ... ‡∏ï‡∏±‡∏î‡∏ó‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ... -->

          <!-- ‡∏õ‡∏∏‡πà‡∏° submit -->
          <button type="submit" class="btn btn-accent btn-full">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô DC
          </button>

          <div class="footer-hint">
            <div>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö <code>HH:mm ‡∏ô.</code></div>
            <div>‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
          </div>
        </form>
      </div>

      <!-- Panel: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á -->
      <!-- ... (‡∏™‡πà‡∏ß‡∏ô history ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤) ... -->

    </div>
  </div>

  <script>
    // üëá ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL Web App ‡∏Ç‡∏≠‡∏á Apps Script (deployment ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQDbS5JZyzkbYxfdDLz8q2XCvBbRqQ9fE36Mn_dgvdabzzDcl4R5oV0tliQo_rLfv8RA/exec";

    /* --------- Tabs --------- */
    const tabButtons = document.querySelectorAll(".tab-btn");
    const panels = document.querySelectorAll(".panel");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.getAttribute("data-tab");
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        panels.forEach((p) => {
          if (p.getAttribute("data-panel") === tab) {
            p.classList.remove("hidden");
          } else {
            p.classList.add("hidden");
          }
        });

        if (tab === "history" && !window.__historyInitialized) {
          window.__historyInitialized = true;
          fetchLogs();
        }
      });
    });

    /* --------- Form DC Log --------- */
    function formatNowLabel() {
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      return `${hh}:${mm} ‡∏ô.`;
    }

    function setNow(fieldId) {
      const el = document.getElementById(fieldId);
      if (!el) return;
      el.value = formatNowLabel();
    }
    window.setNow = setNow;

    const photoInput   = document.getElementById("photoRear");
    const previewBox   = document.getElementById("previewBox");
    const previewImage = document.getElementById("previewImage");

    photoInput?.addEventListener("change", function () {
      const file = this.files && this.files[0];
      if (!file) {
        previewBox.style.display = "none";
        previewImage.src = "";
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        previewImage.src = e.target.result;
        previewBox.style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    const form = document.getElementById("dcForm");
    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const referenceRaw = document.getElementById("reference").value.trim();
      const truckPlate   = document.getElementById("truckPlate").value.trim();
      const arriveDcTime = document.getElementById("arriveDcTime").value.trim();
      const file         = photoInput.files && photoInput.files[0];

      // ‚≠ê Validation: booking 9 ‡∏´‡∏•‡∏±‡∏Å‡∏ù‡∏±‡πà‡∏á frontend
      let numericRef = referenceRaw.replace(/\D+/g, "");
      if (!numericRef || numericRef.length !== 9) {
        Swal.fire(
          "‡πÄ‡∏•‡∏Ç Booking ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
          "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç Booking ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô 251243448",
          "warning"
        );
        return;
      }
      const mm = numericRef.substring(2, 4);
      const monthNum = parseInt(mm, 10);
      if (isNaN(monthNum) || monthNum < 1 || monthNum > 12) {
        Swal.fire(
          "‡πÄ‡∏•‡∏Ç Booking ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
          "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà 3‚Äì4) ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 01‚Äì12",
          "warning"
        );
        return;
      }

      if (!truckPlate) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ", "", "warning");
        return;
      }
      if (!arriveDcTime) {
        Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ "‡∏ñ‡∏∂‡∏á DC"', "", "warning");
        return;
      }
      if (!file) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ", "", "warning");
        return;
      }

      try {
        Swal.fire({
          title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
          html: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        const imageBase64 = await readFileAsDataURL(file);

        const payload = {
          action: "saveDcLog",
          reference: numericRef, // ‚≠ê ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏•‡∏¢
          truckPlate: truckPlate,
          arriveDcTime: arriveDcTime,
          loadStartTime: document.getElementById("loadStartTime").value.trim(),
          loadEndTime: document.getElementById("loadEndTime").value.trim(),
          docStartTime: document.getElementById("docStartTime").value.trim(),
          docEndTime: document.getElementById("docEndTime").value.trim(),
          departTime: document.getElementById("departTime").value.trim(),
          remark: document.getElementById("remark").value.trim(),
          imageBase64: imageBase64,
        };

        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          // ‚≠ê ‡πÉ‡∏ä‡πâ text/plain ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î preflight CORS
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
          body: JSON.stringify(payload),
        });

        const result = await res.json().catch(() => ({}));
        Swal.close();

        if (result && result.success) {
          Swal.fire({
            icon: "success",
            title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            text: result.message || "‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô DC ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
          });
          form.reset();
          previewBox.style.display = "none";
          previewImage.src = "";
        } else {
          Swal.fire({
            icon: "error",
            title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            text:
              (result && result.message) ||
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
          });
        }
      } catch (err) {
        console.error(err);
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô",
        });
      }
    });

    /* --------- History --------- */
    const truckPlateHistoryInput = document.getElementById("truckPlateHistory");
    const dateFromInput   = document.getElementById("dateFrom");
    const dateToInput     = document.getElementById("dateTo");
    const limitSelect     = document.getElementById("limitSelect");
    const btnSearch       = document.getElementById("btnSearch");
    const logBody         = document.getElementById("logBody");
    const countLabel      = document.getElementById("countLabel");

    btnSearch.addEventListener("click", () => fetchLogs());

    async function fetchLogs() {
      const truckPlate = truckPlateHistoryInput.value.trim();
      const dateFrom   = dateFromInput.value;
      const dateTo     = dateToInput.value;
      const limit      = limitSelect.value;

      try {
        Swal.fire({
          title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
          html: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
          allowOutsideClick: false,
          didOpen: () => Swal.showLoading(),
        });

        const params = new URLSearchParams();
        params.set("action", "getDcLogs");
        if (truckPlate) params.set("truckPlate", truckPlate);
        if (dateFrom)   params.set("dateFrom", dateFrom);
        if (dateTo)     params.set("dateTo", dateTo);
        params.set("limit", limit);

        const res = await fetch(`${SCRIPT_URL}?${params.toString()}`, {
          method: "GET",
        });

        const result = await res.json().catch(() => ({}));
        Swal.close();

        if (!result || !result.success) {
          Swal.fire({
            icon: "error",
            title: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ",
            text:
              (result && result.message) ||
              "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
          });
          return;
        }

        renderLogs(result.data || []);
      } catch (err) {
        console.error(err);
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
        });
      }
    }

    function renderLogs(logs) {
      logBody.innerHTML = "";

      if (!logs.length) {
        logBody.innerHTML =
          '<tr><td colspan="9" class="no-data">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>';
        countLabel.textContent = "‡πÅ‡∏™‡∏î‡∏á 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
        return;
      }

      logs.forEach((log) => {
        const tr = document.createElement("tr");

        const loadRange =
          (log.loadStart || "") && (log.loadEnd || "")
            ? `${log.loadStart} - ${log.loadEnd}`
            : (log.loadStart || log.loadEnd || "-");

        const docRange =
          (log.docStart || "") && (log.docEnd || "")
            ? `${log.docStart} - ${log.docEnd}`
            : (log.docStart || log.docEnd || "-");

        tr.innerHTML = `
          <td>${log.dateDisplay || log.timestamp || "-"}</td>
          <td>${log.truckPlate || "-"}</td>
          <td>${log.reference || "-"}</td>
          <td>${log.arriveDc || "-"}</td>
          <td>${loadRange || "-"}</td>
          <td>${docRange || "-"}</td>
          <td>${log.departDc || "-"}</td>
          <td>${escapeHtml(log.remark || "-")}</td>
          <td>
            ${
              log.imageUrl
                ? `<a href="${log.imageUrl}" class="link" target="_blank">‡∏î‡∏π‡∏£‡∏π‡∏õ</a>`
                : "-"
            }
          </td>
        `;
        logBody.appendChild(tr);
      });

      countLabel.textContent = `‡πÅ‡∏™‡∏î‡∏á ${logs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</body>
</html>
