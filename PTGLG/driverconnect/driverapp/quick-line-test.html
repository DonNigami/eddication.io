<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîç Quick LINE LIFF Test</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
    }
    .status {
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 500;
      text-align: center;
    }
    .loading { background: #fff3cd; color: #856404; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    .warning { background: #fff3cd; color: #856404; }
    .detail {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      font-size: 14px;
    }
    .label { font-weight: 600; color: #666; }
    .value { color: #333; margin-left: 10px; }
    .emoji { font-size: 48px; text-align: center; margin: 20px 0; }
    button {
      width: 100%;
      padding: 15px;
      background: #06c755;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover { background: #05b34d; }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç LINE LIFF Quick Test</h1>
    
    <div id="statusBox" class="status loading">
      üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...
    </div>

    <div id="detailsBox"></div>

    <div id="actionBox"></div>
  </div>

  <script>
    const LIFF_ID = '2007705394-Fgx9wdHu';

    function showStatus(message, type = 'info') {
      const box = document.getElementById('statusBox');
      box.textContent = message;
      box.className = `status ${type}`;
    }

    function addDetail(label, value) {
      const box = document.getElementById('detailsBox');
      const detail = document.createElement('div');
      detail.className = 'detail';
      detail.innerHTML = `<span class="label">${label}:</span><span class="value">${value}</span>`;
      box.appendChild(detail);
    }

    async function testLIFF() {
      // Step 1: Check LIFF SDK
      if (typeof liff === 'undefined') {
        showStatus('‚ùå LIFF SDK ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î', 'error');
        addDetail('Error', 'LIFF SDK script ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î');
        addDetail('Solution', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö internet connection ‡∏´‡∏£‡∏∑‡∏≠ CDN');
        return;
      }

      addDetail('‚úÖ LIFF SDK', 'Loaded');

      // Step 2: Check browser
      const ua = navigator.userAgent.toLowerCase();
      const isLINE = ua.includes('line');
      addDetail('Browser', isLINE ? '‚úÖ LINE App' : '‚ùå ' + (
        ua.includes('chrome') ? 'Chrome' :
        ua.includes('firefox') ? 'Firefox' :
        ua.includes('safari') ? 'Safari' : 'Unknown'
      ));

      // Step 3: Initialize LIFF
      try {
        showStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á initialize LIFF...', 'loading');
        await liff.init({ liffId: LIFF_ID });
        
        addDetail('‚úÖ LIFF Init', 'Success');
        addDetail('LIFF ID', LIFF_ID);
        
        // Step 4: Check status
        const inClient = liff.isInClient();
        const loggedIn = liff.isLoggedIn();
        
        addDetail('In LINE Client', inClient ? '‚úÖ Yes' : '‚ùå No');
        addDetail('Logged In', loggedIn ? '‚úÖ Yes' : '‚ùå No');
        addDetail('OS', liff.getOS());
        addDetail('Language', liff.getLanguage());

        // Step 5: Get profile if possible
        if (loggedIn) {
          try {
            const profile = await liff.getProfile();
            showStatus(`‚úÖ ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${profile.displayName}!`, 'success');
            
            document.getElementById('actionBox').innerHTML = `
              <div class="emoji">üë§</div>
              <div class="detail">
                <span class="label">User ID:</span>
                <span class="value">${profile.userId.substring(0, 20)}...</span>
              </div>
              <div class="detail">
                <span class="label">Display Name:</span>
                <span class="value">${profile.displayName}</span>
              </div>
              ${profile.pictureUrl ? `<img src="${profile.pictureUrl}" style="width:80px;height:80px;border-radius:50%;margin:15px auto;display:block;">` : ''}
            `;
          } catch (err) {
            showStatus('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á profile ‡πÑ‡∏î‡πâ', 'warning');
            addDetail('Error', err.message);
          }
        } else {
          // Not logged in
          if (inClient) {
            showStatus('‚ö†Ô∏è ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô LINE ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login', 'warning');
            document.getElementById('actionBox').innerHTML = `
              <div class="emoji">üîê</div>
              <button onclick="liff.login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE</button>
            `;
          } else {
            showStatus('‚ÑπÔ∏è ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App', 'info');
            document.getElementById('actionBox').innerHTML = `
              <div class="emoji">üì±</div>
              <div class="detail" style="text-align:center;">
                <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong><br><br>
                1. Upload ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á hosting (HTTPS)<br>
                2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF Endpoint URL<br>
                3. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE app:<br>
                <code style="background:#e9ecef;padding:5px;border-radius:3px;display:inline-block;margin-top:10px;">
                  https://liff.line.me/${LIFF_ID}
                </code>
              </div>
            `;
          }
        }

      } catch (err) {
        showStatus('‚ùå LIFF Error: ' + err.message, 'error');
        addDetail('Error Name', err.name);
        addDetail('Error Code', err.code || 'N/A');
        
        document.getElementById('actionBox').innerHTML = `
          <div class="emoji">‚ùå</div>
          <div class="detail">
            <strong>Common Issues:</strong><br><br>
            ‚Ä¢ LIFF_ID_NOT_FOUND: LIFF ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á<br>
            ‚Ä¢ UNAUTHORIZED: Endpoint URL ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á<br>
            ‚Ä¢ Network Error: ‡πÑ‡∏°‡πà‡∏°‡∏µ internet<br>
            ‚Ä¢ Invalid LIFF ID: LIFF ID ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î
          </div>
          <pre>${err.stack}</pre>
        `;
      }
    }

    // Auto run
    testLIFF();
  </script>
</body>
</html>
