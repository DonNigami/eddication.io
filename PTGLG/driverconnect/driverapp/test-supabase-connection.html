<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <h1>Supabase Connection Test</h1>
  <button id="testBtn">Test Connection</button>
  <div id="result"></div>

  <script type="module">
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from '../shared/config.js';

    console.log('1. Checking if Supabase SDK loaded...');
    console.log('window.supabase:', window.supabase);

    let supabase;
    try {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      console.log('2. Supabase client created:', supabase);
    } catch (err) {
      console.error('Error creating client:', err);
    }

    document.getElementById('testBtn').addEventListener('click', async () => {
      console.log('3. Testing connection...');
      const result = document.getElementById('result');
      result.textContent = 'Testing...';

      try {
        const { data, error } = await supabase
          .from('jobdata')
          .select('reference')
          .limit(1);

        if (error) {
          console.error('4. Query error:', error);
          result.textContent = 'Error: ' + error.message;
          result.style.color = 'red';
        } else {
          console.log('4. Query success:', data);
          result.textContent = 'Success! Got ' + (data ? data.length : 0) + ' records';
          result.style.color = 'green';
        }
      } catch (err) {
        console.error('4. Exception:', err);
        result.textContent = 'Exception: ' + err.message;
        result.style.color = 'red';
      }
    });

    console.log('Test page loaded. Click button to test.');
  </script>
</body>
</html>
