# р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Telegram Notifications р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ъ Subscription

## р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓

### 1. р╕кр╕гр╣Йр╕▓р╕З Telegram Bot

1. р╕Др╣Йр╕Щр╕лр╕▓ `@BotFather` р╣Гр╕Щ Telegram
2. р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕З `/newbot`
3. р╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕н Bot (р╣Ар╕Кр╣Ир╕Щ "Eddication CRM Notifications")
4. р╕Хр╕▒р╣Йр╕З username (р╣Ар╕Кр╣Ир╕Щ "eddication_crm_bot")
5. **р╕Др╕▒р╕Фр╕ер╕нр╕Б Bot Token** р╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ъ (р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З: `123456789:ABCdefGHIjklmnOPQRstuvwxyz`)

### 2. р╕кр╕гр╣Йр╕▓р╕З Telegram Channel/Group

1. р╕кр╕гр╣Йр╕▓р╕З Private Channel р╕лр╕гр╕╖р╕н Group р╣Гр╕лр╕бр╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ
2. р╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕н (р╣Ар╕Кр╣Ир╕Щ "CRM Subscription Notifications")
3. р╣Ар╕Юр╕┤р╣Ир╕б Bot р╣Ар╕Вр╣Йр╕▓ Channel/Group р╕Щр╕▒р╣Йр╕Щ
4. р╣Гр╕лр╣Й Bot р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б

### 3. р╕Др╣Йр╕Щр╕лр╕▓ Chat ID

**р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Й BotFather**
1. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Фр╣Ж р╣Др╕Ыр╕вр╕▒р╕З Bot р╕Вр╕нр╕Зр╕Др╕╕р╕У
2. р╣Ар╕вр╕╡р╣Ир╕вр╕б URL: `https://api.telegram.org/bot<BOT_TOKEN>/getUpdates`
3. р╕лр╕▓ `"chat":{"id":<CHAT_ID>}`

**р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╕кр╣Ир╕зр╕Щ Extension р╕Вр╕нр╕З Telegram**
1. р╣Др╕Ыр╕вр╕▒р╕З Channel/Group р╕Вр╕нр╕Зр╕Др╕╕р╕У
2. р╕Фр╕╣р╣Гр╕Щ URL р╕лр╕гр╕╖р╕н Properties

### 4. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Environment Variables

р╕кр╕гр╣Йр╕▓р╕З/р╕Ыр╕гр╕▒р╕Ър╣Бр╕Бр╣Йр╣Др╕Яр╕ер╣М `.env` р╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М `backend/`:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklmnOPQRstuvwxyz
TELEGRAM_CHAT_ID=-1001234567890

# Backend URL (р╕кр╕│р╕лр╕гр╕▒р╕Ъ Frontend р╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕гр╕╡р╕вр╕Б API)
BACKEND_URL=http://localhost:3000
```

### 5. р╕Чр╕Фр╕кр╕нр╕Ъ

**р╕Чр╕Фр╕кр╕нр╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б curl:**
```bash
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/sendMessage" \
  -d "chat_id=<CHAT_ID>" \
  -d "text=Test message from CRM" \
  -d "parse_mode=Markdown"
```

**р╕Чр╕Фр╕кр╕нр╕Ър╕Ир╕▓р╕Б API:**
```bash
curl -X POST "http://localhost:3000/api/subscription/notify" \
  -H "Content-Type: application/json" \
  -d '{
    "package_name": "Gold",
    "customer_info": {
      "name": "Test Customer",
      "phone": "0812345678"
    },
    "duration_months": 12,
    "total_price": 10788,
    "original_price": 10788,
    "discount_percent": 0,
    "slip_url": "https://example.com/slip.jpg",
    "submission_time": "2025-01-01T10:00:00Z"
  }'
```

## р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Др╕Ы Telegram

### р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕З:
- тЬУ р╕Кр╕╖р╣Ир╕нр╣Бр╕ер╕░р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕гр╕ер╕╣р╕Бр╕Др╣Йр╕▓
- тЬУ р╕Кр╕╖р╣Ир╕нр╣Бр╕Юр╕Др╣Ар╕Бр╕Ир╕Чр╕╡р╣Ир╕кр╕бр╕▒р╕Др╕г
- тЬУ р╕гр╕░р╕вр╕░р╣Ар╕зр╕ер╕▓ (р╣Ар╕Фр╕╖р╕нр╕Щ)
- тЬУ р╕гр╕▓р╕Др╕▓р╣Ар╕Фр╕┤р╕б, р╕кр╣Ир╕зр╕Щр╕ер╕Ф, р╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в
- тЬУ р╕гр╕╣р╕Ыр╕кр╕ер╕┤р╕Ыр╕Бр╕▓р╕гр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ
- тЬУ р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Гр╕Ър╕кр╕бр╕▒р╕Др╕г
- тЬУ LINE User ID (р╕Цр╣Йр╕▓р╕бр╕╡)

## р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З Message р╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╕бр╕▓

### 1. р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е (Text)
```
ЁЯОЙ *р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Гр╕лр╕бр╣И: р╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б*

ЁЯСд *р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╕╣р╕Бр╕Др╣Йр╕▓:*
тАв р╕Кр╕╖р╣Ир╕н: [р╕Кр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓]
тАв р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г: [р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г]
тАв LINE User ID: [ID]

ЁЯУж *р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Бр╕Юр╕Др╣Ар╕Бр╕И:*
тАв р╕Кр╕╖р╣Ир╕нр╣Бр╕Юр╕Др╣Ар╕Бр╕И: [р╕Кр╕╖р╣Ир╕н]
тАв р╕гр╕░р╕вр╕░р╣Ар╕зр╕ер╕▓: [р╣Ар╕Фр╕╖р╕нр╕Щ] р╣Ар╕Фр╕╖р╕нр╕Щ
тАв р╕гр╕▓р╕Др╕▓р╕Хр╕▒р╣Йр╕Зр╕Хр╣Йр╕Щ: р╕┐[р╕гр╕▓р╕Др╕▓]
тАв р╕кр╣Ир╕зр╕Щр╕ер╕Ф: [%]%
тАв р╕гр╕▓р╕Др╕▓р╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в: р╕┐[р╕гр╕▓р╕Др╕▓]

ЁЯУЭ *р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕З:* [timestamp]
ЁЯХР *р╣Ар╕зр╕ер╕▓:* [р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕зр╕ер╕▓]
```

### 2. р╕гр╕╣р╕Ыр╕кр╕ер╕┤р╕Ы (Photo)
р╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕кр╕ер╕┤р╕Бр╕Хр╕▓р╕бр╕бр╕▓р╕Фр╣Йр╕зр╕в Caption р╕Юр╕гр╣Йр╕нр╕бр╕Кр╕╖р╣Ир╕нр╕ер╕╣р╕Бр╕Др╣Йр╕▓

## Admin Dashboard

- **Tab: "я┐╜цЦ░ р╣Гр╕Ър╕кр╕бр╕▒р╕Др╕гр╣Гр╕лр╕бр╣И"** р╣Бр╕кр╕Фр╕Зр╕Ир╕│р╕Щр╕зр╕Щр╕Чр╕╡р╣Ир╕гр╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ
- **р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е:**
  - р╕Кр╕╖р╣Ир╕н, р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г, р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╣Ир╕З
  - р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Бр╕Юр╕Др╣Ар╕Бр╕Ир╣Бр╕ер╕░р╕гр╕▓р╕Др╕▓
  - Preview р╕кр╕ер╕┤р╕Ыр╕Бр╕▓р╕гр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ
  - р╕Ыр╕╕р╣Ир╕б: р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤, р╕Ыр╕Пр╕┤р╣Ар╕кр╕Ш, р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф

## Error Handling

- р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕бр╕╡ `TELEGRAM_BOT_TOKEN` р╕лр╕гр╕╖р╕н `TELEGRAM_CHAT_ID` тЖТ р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕╖р╕нр╕Щ (р╣Др╕бр╣Ир╕ер╣Йр╕бр╣Ар╕лр╕ер╕з)
- р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╣Ир╕З Telegram тЖТ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б error р╣Бр╕Хр╣Ир╕вр╕▒р╕Зр╕Др╕Зр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Гр╕Ър╕кр╕бр╕▒р╕Др╕гр╕кр╕│р╣Ар╕гр╣Зр╕И
- р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕кр╕ер╕┤р╕Ы тЖТ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ (р╣Др╕бр╣Ир╕кр╣Ир╕Зр╕гр╕╣р╕Ы)

## Flow р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

1. р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╣Ир╕Зр╕лр╕ер╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е + р╕кр╕ер╕┤р╕Ы тЖТ Subscribe Page
2. Frontend р╕нр╕▒р╕Юр╣Вр╕лр╕ер╕Фр╕кр╕ер╕┤р╕Ы тЖТ Supabase Storage
3. Frontend р╣Ар╕гр╕╡р╕вр╕Б Backend API тЖТ `/api/subscription/notify`
4. Backend р╕кр╣Ир╕З Notification тЖТ Telegram
5. Admin р╕Фр╕╣ Tab "р╣Гр╕Ър╕кр╕бр╕▒р╕Др╕гр╣Гр╕лр╕бр╣И" тЖТ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤/р╕Ыр╕Пр╕┤р╣Ар╕кр╕Ш
6. Admin р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ тЖТ р╕кр╣Ир╕З LINE notification р╣Др╕Ыр╕лр╕▓р╕ер╕╣р╕Бр╕Др╣Йр╕▓

## Notes

- Chat ID р╕Хр╣Йр╕нр╕Зр╣Ар╕Ыр╣Зр╕Щ negative number р╕кр╕│р╕лр╕гр╕▒р╕Ъ Channel (р╣Ар╕Кр╣Ир╕Щ `-1001234567890`)
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Bot р╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щр╣Бр╕Хр╣Ир╕ер╕░ Channel/Group
- р╣Гр╕Кр╣Й `parse_mode: 'Markdown'` р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Й format р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Др╕Фр╣Йр╕кр╕зр╕в
